

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>airdrops.protocols.zksync.zksync &mdash; Airdrops Automation API Docs 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Airdrops Automation API Docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../protocols.html">Protocols API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols">Main Protocols Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols.hyperliquid">Hyperliquid Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.hyperliquid.stake_rotate"><code class="docutils literal notranslate"><span class="pre">stake_rotate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.hyperliquid.vault_cycle"><code class="docutils literal notranslate"><span class="pre">vault_cycle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.hyperliquid.spot_swap"><code class="docutils literal notranslate"><span class="pre">spot_swap()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.hyperliquid.evm_roundtrip"><code class="docutils literal notranslate"><span class="pre">evm_roundtrip()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.hyperliquid.perform_random_onchain"><code class="docutils literal notranslate"><span class="pre">perform_random_onchain()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols.layerzero">LayerZero Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.layerzero.layerzero.bridge"><code class="docutils literal notranslate"><span class="pre">bridge()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.layerzero.layerzero.perform_random_bridge"><code class="docutils literal notranslate"><span class="pre">perform_random_bridge()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols.scroll">Scroll Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.scroll.bridge_assets"><code class="docutils literal notranslate"><span class="pre">bridge_assets()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.scroll.swap_tokens"><code class="docutils literal notranslate"><span class="pre">swap_tokens()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.scroll.provide_liquidity_scroll"><code class="docutils literal notranslate"><span class="pre">provide_liquidity_scroll()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.scroll.lend_borrow_layerbank_scroll"><code class="docutils literal notranslate"><span class="pre">lend_borrow_layerbank_scroll()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.scroll.perform_random_activity_scroll"><code class="docutils literal notranslate"><span class="pre">perform_random_activity_scroll()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollBridgeError"><code class="docutils literal notranslate"><span class="pre">ScrollBridgeError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.InsufficientBalanceError"><code class="docutils literal notranslate"><span class="pre">InsufficientBalanceError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TransactionRevertedError"><code class="docutils literal notranslate"><span class="pre">TransactionRevertedError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TransactionRevertedError.__init__"><code class="docutils literal notranslate"><span class="pre">TransactionRevertedError.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.RPCError"><code class="docutils literal notranslate"><span class="pre">RPCError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ApprovalError"><code class="docutils literal notranslate"><span class="pre">ApprovalError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.GasEstimationError"><code class="docutils literal notranslate"><span class="pre">GasEstimationError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.MaxRetriesExceededError"><code class="docutils literal notranslate"><span class="pre">MaxRetriesExceededError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TransactionBuildError"><code class="docutils literal notranslate"><span class="pre">TransactionBuildError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TransactionSendError"><code class="docutils literal notranslate"><span class="pre">TransactionSendError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TransactionReceiptError"><code class="docutils literal notranslate"><span class="pre">TransactionReceiptError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollValueError"><code class="docutils literal notranslate"><span class="pre">ScrollValueError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.TokenNotSupportedError"><code class="docutils literal notranslate"><span class="pre">TokenNotSupportedError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollSwapError"><code class="docutils literal notranslate"><span class="pre">ScrollSwapError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollSwapError.__init__"><code class="docutils literal notranslate"><span class="pre">ScrollSwapError.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.InsufficientLiquidityError"><code class="docutils literal notranslate"><span class="pre">InsufficientLiquidityError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollLendingError"><code class="docutils literal notranslate"><span class="pre">ScrollLendingError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.InsufficientCollateralError"><code class="docutils literal notranslate"><span class="pre">InsufficientCollateralError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.MarketNotEnteredError"><code class="docutils literal notranslate"><span class="pre">MarketNotEnteredError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.RepayAmountExceedsDebtError"><code class="docutils literal notranslate"><span class="pre">RepayAmountExceedsDebtError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.LayerBankComptrollerRejectionError"><code class="docutils literal notranslate"><span class="pre">LayerBankComptrollerRejectionError</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.LayerBankComptrollerRejectionError.__init__"><code class="docutils literal notranslate"><span class="pre">LayerBankComptrollerRejectionError.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.scroll.exceptions.ScrollRandomActivityError"><code class="docutils literal notranslate"><span class="pre">ScrollRandomActivityError</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols.zksync">zkSync Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.bridge_eth"><code class="docutils literal notranslate"><span class="pre">bridge_eth()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.swap_tokens"><code class="docutils literal notranslate"><span class="pre">swap_tokens()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.lend_borrow"><code class="docutils literal notranslate"><span class="pre">lend_borrow()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.perform_random_activity"><code class="docutils literal notranslate"><span class="pre">perform_random_activity()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../protocols.html#module-airdrops.protocols.eigenlayer">EigenLayer Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.restake_lst"><code class="docutils literal notranslate"><span class="pre">restake_lst()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.DepositCapReachedError"><code class="docutils literal notranslate"><span class="pre">DepositCapReachedError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.EigenLayerRestakeError"><code class="docutils literal notranslate"><span class="pre">EigenLayerRestakeError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.UnsupportedLSTError"><code class="docutils literal notranslate"><span class="pre">UnsupportedLSTError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.eigenlayer.restake_lst"><code class="docutils literal notranslate"><span class="pre">restake_lst()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.eigenlayer.UnsupportedLSTError"><code class="docutils literal notranslate"><span class="pre">UnsupportedLSTError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.eigenlayer.EigenLayerRestakeError"><code class="docutils literal notranslate"><span class="pre">EigenLayerRestakeError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.eigenlayer.DepositCapReachedError"><code class="docutils literal notranslate"><span class="pre">DepositCapReachedError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.exceptions.EigenLayerRestakeError"><code class="docutils literal notranslate"><span class="pre">EigenLayerRestakeError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.exceptions.UnsupportedLSTError"><code class="docutils literal notranslate"><span class="pre">UnsupportedLSTError</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols.html#airdrops.protocols.eigenlayer.exceptions.DepositCapReachedError"><code class="docutils literal notranslate"><span class="pre">DepositCapReachedError</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scheduler.html">Scheduler API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../scheduler.html#module-airdrops.scheduler">Scheduler Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler"><code class="docutils literal notranslate"><span class="pre">CentralScheduler</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.__init__"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.add_job"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.add_job()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.handle_task_failure"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.handle_task_failure()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.manage_task_dependencies"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.manage_task_dependencies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.manage_task_priority"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.manage_task_priority()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.schedule_dynamically"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.schedule_dynamically()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.start"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.CentralScheduler.stop"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.stop()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../scheduler.html#module-airdrops.scheduler.bot">Scheduler Bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus"><code class="docutils literal notranslate"><span class="pre">TaskStatus</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.PENDING"><code class="docutils literal notranslate"><span class="pre">TaskStatus.PENDING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.RUNNING"><code class="docutils literal notranslate"><span class="pre">TaskStatus.RUNNING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.COMPLETED"><code class="docutils literal notranslate"><span class="pre">TaskStatus.COMPLETED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.FAILED"><code class="docutils literal notranslate"><span class="pre">TaskStatus.FAILED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.RETRYING"><code class="docutils literal notranslate"><span class="pre">TaskStatus.RETRYING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskStatus.CANCELLED"><code class="docutils literal notranslate"><span class="pre">TaskStatus.CANCELLED</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskPriority"><code class="docutils literal notranslate"><span class="pre">TaskPriority</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskPriority.LOW"><code class="docutils literal notranslate"><span class="pre">TaskPriority.LOW</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskPriority.NORMAL"><code class="docutils literal notranslate"><span class="pre">TaskPriority.NORMAL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskPriority.HIGH"><code class="docutils literal notranslate"><span class="pre">TaskPriority.HIGH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskPriority.CRITICAL"><code class="docutils literal notranslate"><span class="pre">TaskPriority.CRITICAL</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition"><code class="docutils literal notranslate"><span class="pre">TaskDefinition</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.task_id"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.task_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.func"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.func</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.args"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.args</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.kwargs"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.kwargs</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.priority"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.priority</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.dependencies"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.dependencies</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.max_retries"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.max_retries</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.retry_delay"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.retry_delay</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.timeout"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.timeout</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.metadata"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.metadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.__post_init__"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskDefinition.__init__"><code class="docutils literal notranslate"><span class="pre">TaskDefinition.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution"><code class="docutils literal notranslate"><span class="pre">TaskExecution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.task_id"><code class="docutils literal notranslate"><span class="pre">TaskExecution.task_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.status"><code class="docutils literal notranslate"><span class="pre">TaskExecution.status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.start_time"><code class="docutils literal notranslate"><span class="pre">TaskExecution.start_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.end_time"><code class="docutils literal notranslate"><span class="pre">TaskExecution.end_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.retry_count"><code class="docutils literal notranslate"><span class="pre">TaskExecution.retry_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.last_error"><code class="docutils literal notranslate"><span class="pre">TaskExecution.last_error</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.result"><code class="docutils literal notranslate"><span class="pre">TaskExecution.result</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.TaskExecution.__init__"><code class="docutils literal notranslate"><span class="pre">TaskExecution.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler"><code class="docutils literal notranslate"><span class="pre">CentralScheduler</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.__init__"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.add_job"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.add_job()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.manage_task_priority"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.manage_task_priority()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.manage_task_dependencies"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.manage_task_dependencies()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.schedule_dynamically"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.schedule_dynamically()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.handle_task_failure"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.handle_task_failure()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.start"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.CentralScheduler.stop"><code class="docutils literal notranslate"><span class="pre">CentralScheduler.stop()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../scheduler.html#airdrops.scheduler.bot.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../risk_management.html">Risk Management API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../risk_management.html#risk-management-module">Risk Management Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../risk_management.html#risk-management-core">Risk Management Core</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../capital_allocation.html">Capital Allocation API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../capital_allocation.html#module-airdrops.capital_allocation">Capital Allocation Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator.__init__"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator.allocate_risk_adjusted_capital"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.allocate_risk_adjusted_capital()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator.calculate_efficiency_metrics"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.calculate_efficiency_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator.optimize_portfolio"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.optimize_portfolio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.CapitalAllocator.rebalance_portfolio"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.rebalance_portfolio()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../capital_allocation.html#module-airdrops.capital_allocation.engine">Capital Allocation Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator.__init__"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator.optimize_portfolio"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.optimize_portfolio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator.allocate_risk_adjusted_capital"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.allocate_risk_adjusted_capital()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator.rebalance_portfolio"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.rebalance_portfolio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.CapitalAllocator.calculate_efficiency_metrics"><code class="docutils literal notranslate"><span class="pre">CapitalAllocator.calculate_efficiency_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationStrategy"><code class="docutils literal notranslate"><span class="pre">AllocationStrategy</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationStrategy.EQUAL_WEIGHT"><code class="docutils literal notranslate"><span class="pre">AllocationStrategy.EQUAL_WEIGHT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationStrategy.RISK_PARITY"><code class="docutils literal notranslate"><span class="pre">AllocationStrategy.RISK_PARITY</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationStrategy.MEAN_VARIANCE"><code class="docutils literal notranslate"><span class="pre">AllocationStrategy.MEAN_VARIANCE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationStrategy.KELLY_CRITERION"><code class="docutils literal notranslate"><span class="pre">AllocationStrategy.KELLY_CRITERION</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget"><code class="docutils literal notranslate"><span class="pre">AllocationTarget</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.protocol"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.protocol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.target_percentage"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.target_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.current_percentage"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.current_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.risk_score"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.risk_score</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.expected_return"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.expected_return</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.AllocationTarget.__init__"><code class="docutils literal notranslate"><span class="pre">AllocationTarget.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.total_value"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.total_return"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_return</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.sharpe_ratio"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.sharpe_ratio</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.max_drawdown"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.max_drawdown</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.capital_utilization"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.capital_utilization</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.protocol_allocations"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.protocol_allocations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.PortfolioMetrics.__init__"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder.protocol"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder.protocol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder.action"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder.action</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder.amount"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder.amount</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder.priority"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder.priority</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../capital_allocation.html#airdrops.capital_allocation.engine.RebalanceOrder.__init__"><code class="docutils literal notranslate"><span class="pre">RebalanceOrder.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../monitoring.html">Monitoring API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../monitoring.html#module-airdrops.monitoring">Monitoring Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector"><code class="docutils literal notranslate"><span class="pre">MetricsCollector</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.__init__"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.collect_all_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_all_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.collect_capital_allocator_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_capital_allocator_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.collect_risk_manager_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_risk_manager_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.collect_scheduler_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_scheduler_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.collect_system_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_system_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsCollector.export_prometheus_format"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.export_prometheus_format()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.__init__"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.add_metrics_to_buffer"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.add_metrics_to_buffer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.aggregate_time_window"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.aggregate_time_window()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.get_aggregated_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.get_aggregated_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.process_component_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_component_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.process_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.MetricsAggregator.process_system_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_system_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter"><code class="docutils literal notranslate"><span class="pre">Alerter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.__init__"><code class="docutils literal notranslate"><span class="pre">Alerter.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.evaluate_rules"><code class="docutils literal notranslate"><span class="pre">Alerter.evaluate_rules()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.get_active_alerts"><code class="docutils literal notranslate"><span class="pre">Alerter.get_active_alerts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.get_alert_history"><code class="docutils literal notranslate"><span class="pre">Alerter.get_alert_history()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.load_alert_rules"><code class="docutils literal notranslate"><span class="pre">Alerter.load_alert_rules()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.load_notification_channels"><code class="docutils literal notranslate"><span class="pre">Alerter.load_notification_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.Alerter.send_notifications"><code class="docutils literal notranslate"><span class="pre">Alerter.send_notifications()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.HealthChecker"><code class="docutils literal notranslate"><span class="pre">HealthChecker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.HealthChecker.__init__"><code class="docutils literal notranslate"><span class="pre">HealthChecker.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.HealthChecker.check_component_health"><code class="docutils literal notranslate"><span class="pre">HealthChecker.check_component_health()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.HealthChecker.check_system_health"><code class="docutils literal notranslate"><span class="pre">HealthChecker.check_system_health()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.HealthChecker.start_server"><code class="docutils literal notranslate"><span class="pre">HealthChecker.start_server()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../monitoring.html#module-airdrops.monitoring.collector">Metrics Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector"><code class="docutils literal notranslate"><span class="pre">MetricsCollector</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.__init__"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.collect_system_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_system_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.collect_risk_manager_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_risk_manager_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.collect_capital_allocator_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_capital_allocator_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.collect_scheduler_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_scheduler_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.collect_all_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.collect_all_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.MetricsCollector.export_prometheus_format"><code class="docutils literal notranslate"><span class="pre">MetricsCollector.export_prometheus_format()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics"><code class="docutils literal notranslate"><span class="pre">SystemMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.cpu_usage_percent"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.cpu_usage_percent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.memory_usage_percent"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.memory_usage_percent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.disk_usage_percent"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.disk_usage_percent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.network_bytes_sent"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.network_bytes_sent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.network_bytes_recv"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.network_bytes_recv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.SystemMetrics.__init__"><code class="docutils literal notranslate"><span class="pre">SystemMetrics.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.component_name"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.component_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.status"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.last_execution_time"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.last_execution_time</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.error_count"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.error_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.success_count"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.success_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.collector.ComponentMetrics.__init__"><code class="docutils literal notranslate"><span class="pre">ComponentMetrics.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../monitoring.html#module-airdrops.monitoring.aggregator">Metrics Aggregator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.__init__"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.add_metrics_to_buffer"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.add_metrics_to_buffer()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.process_system_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_system_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.process_component_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_component_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.aggregate_time_window"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.aggregate_time_window()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.process_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.process_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.MetricsAggregator.get_aggregated_metrics"><code class="docutils literal notranslate"><span class="pre">MetricsAggregator.get_aggregated_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.metric_name"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.metric_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.value"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.timestamp"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.timestamp</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.labels"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.labels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.aggregation_type"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.aggregation_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregatedMetric.__init__"><code class="docutils literal notranslate"><span class="pre">AggregatedMetric.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregationConfig"><code class="docutils literal notranslate"><span class="pre">AggregationConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregationConfig.window_size_seconds"><code class="docutils literal notranslate"><span class="pre">AggregationConfig.window_size_seconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregationConfig.aggregation_functions"><code class="docutils literal notranslate"><span class="pre">AggregationConfig.aggregation_functions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregationConfig.retention_period_hours"><code class="docutils literal notranslate"><span class="pre">AggregationConfig.retention_period_hours</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.aggregator.AggregationConfig.__init__"><code class="docutils literal notranslate"><span class="pre">AggregationConfig.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../monitoring.html#module-airdrops.monitoring.alerter">Alerting System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter"><code class="docutils literal notranslate"><span class="pre">Alerter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.__init__"><code class="docutils literal notranslate"><span class="pre">Alerter.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.load_alert_rules"><code class="docutils literal notranslate"><span class="pre">Alerter.load_alert_rules()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.load_notification_channels"><code class="docutils literal notranslate"><span class="pre">Alerter.load_notification_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.evaluate_rules"><code class="docutils literal notranslate"><span class="pre">Alerter.evaluate_rules()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.send_notifications"><code class="docutils literal notranslate"><span class="pre">Alerter.send_notifications()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.get_active_alerts"><code class="docutils literal notranslate"><span class="pre">Alerter.get_active_alerts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alerter.get_alert_history"><code class="docutils literal notranslate"><span class="pre">Alerter.get_alert_history()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule"><code class="docutils literal notranslate"><span class="pre">AlertRule</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.name"><code class="docutils literal notranslate"><span class="pre">AlertRule.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.metric_name"><code class="docutils literal notranslate"><span class="pre">AlertRule.metric_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.condition"><code class="docutils literal notranslate"><span class="pre">AlertRule.condition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.threshold"><code class="docutils literal notranslate"><span class="pre">AlertRule.threshold</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.severity"><code class="docutils literal notranslate"><span class="pre">AlertRule.severity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.description"><code class="docutils literal notranslate"><span class="pre">AlertRule.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.for_duration"><code class="docutils literal notranslate"><span class="pre">AlertRule.for_duration</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.labels"><code class="docutils literal notranslate"><span class="pre">AlertRule.labels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.__post_init__"><code class="docutils literal notranslate"><span class="pre">AlertRule.__post_init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertRule.__init__"><code class="docutils literal notranslate"><span class="pre">AlertRule.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert"><code class="docutils literal notranslate"><span class="pre">Alert</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.rule_name"><code class="docutils literal notranslate"><span class="pre">Alert.rule_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.metric_name"><code class="docutils literal notranslate"><span class="pre">Alert.metric_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.current_value"><code class="docutils literal notranslate"><span class="pre">Alert.current_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.threshold"><code class="docutils literal notranslate"><span class="pre">Alert.threshold</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.severity"><code class="docutils literal notranslate"><span class="pre">Alert.severity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.status"><code class="docutils literal notranslate"><span class="pre">Alert.status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.description"><code class="docutils literal notranslate"><span class="pre">Alert.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.timestamp"><code class="docutils literal notranslate"><span class="pre">Alert.timestamp</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.labels"><code class="docutils literal notranslate"><span class="pre">Alert.labels</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.firing_since"><code class="docutils literal notranslate"><span class="pre">Alert.firing_since</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.resolved_at"><code class="docutils literal notranslate"><span class="pre">Alert.resolved_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.Alert.__init__"><code class="docutils literal notranslate"><span class="pre">Alert.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel"><code class="docutils literal notranslate"><span class="pre">NotificationChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel.name"><code class="docutils literal notranslate"><span class="pre">NotificationChannel.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel.type"><code class="docutils literal notranslate"><span class="pre">NotificationChannel.type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel.config"><code class="docutils literal notranslate"><span class="pre">NotificationChannel.config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel.enabled"><code class="docutils literal notranslate"><span class="pre">NotificationChannel.enabled</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.NotificationChannel.__init__"><code class="docutils literal notranslate"><span class="pre">NotificationChannel.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertSeverity"><code class="docutils literal notranslate"><span class="pre">AlertSeverity</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertSeverity.LOW"><code class="docutils literal notranslate"><span class="pre">AlertSeverity.LOW</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertSeverity.MEDIUM"><code class="docutils literal notranslate"><span class="pre">AlertSeverity.MEDIUM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertSeverity.HIGH"><code class="docutils literal notranslate"><span class="pre">AlertSeverity.HIGH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertSeverity.CRITICAL"><code class="docutils literal notranslate"><span class="pre">AlertSeverity.CRITICAL</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertStatus"><code class="docutils literal notranslate"><span class="pre">AlertStatus</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertStatus.FIRING"><code class="docutils literal notranslate"><span class="pre">AlertStatus.FIRING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertStatus.RESOLVED"><code class="docutils literal notranslate"><span class="pre">AlertStatus.RESOLVED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.alerter.AlertStatus.PENDING"><code class="docutils literal notranslate"><span class="pre">AlertStatus.PENDING</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../monitoring.html#module-airdrops.monitoring.health_checker">Health Checker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthChecker"><code class="docutils literal notranslate"><span class="pre">HealthChecker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthChecker.__init__"><code class="docutils literal notranslate"><span class="pre">HealthChecker.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthChecker.check_system_health"><code class="docutils literal notranslate"><span class="pre">HealthChecker.check_system_health()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthChecker.check_component_health"><code class="docutils literal notranslate"><span class="pre">HealthChecker.check_component_health()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthChecker.start_server"><code class="docutils literal notranslate"><span class="pre">HealthChecker.start_server()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthStatus"><code class="docutils literal notranslate"><span class="pre">HealthStatus</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthStatus.OK"><code class="docutils literal notranslate"><span class="pre">HealthStatus.OK</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthStatus.WARNING"><code class="docutils literal notranslate"><span class="pre">HealthStatus.WARNING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.HealthStatus.CRITICAL"><code class="docutils literal notranslate"><span class="pre">HealthStatus.CRITICAL</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth"><code class="docutils literal notranslate"><span class="pre">ComponentHealth</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.component_name"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.component_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.status"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.message"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.message</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.last_check"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.last_check</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.metrics"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.ComponentHealth.__init__"><code class="docutils literal notranslate"><span class="pre">ComponentHealth.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth"><code class="docutils literal notranslate"><span class="pre">SystemHealth</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth.overall_status"><code class="docutils literal notranslate"><span class="pre">SystemHealth.overall_status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth.timestamp"><code class="docutils literal notranslate"><span class="pre">SystemHealth.timestamp</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth.components"><code class="docutils literal notranslate"><span class="pre">SystemHealth.components</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth.summary"><code class="docutils literal notranslate"><span class="pre">SystemHealth.summary</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../monitoring.html#airdrops.monitoring.health_checker.SystemHealth.__init__"><code class="docutils literal notranslate"><span class="pre">SystemHealth.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../analytics.html">Analytics API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics">Analytics Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker"><code class="docutils literal notranslate"><span class="pre">AirdropTracker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker.get_airdrops_by_date_range"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_date_range()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker.get_airdrops_by_protocol"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_protocol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker.get_airdrops_by_wallet"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_wallet()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropTracker.record_airdrop"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.record_airdrop()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent"><code class="docutils literal notranslate"><span class="pre">AirdropEvent</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.ConfigDict"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.ConfigDict</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.model_config"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.validate_protocol_name"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.validate_protocol_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.validate_token_symbol"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.validate_token_symbol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.protocol_name"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.token_symbol"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.token_symbol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.amount_received"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.amount_received</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.estimated_value_usd"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.estimated_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.wallet_address"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.wallet_address</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.transaction_hash"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.transaction_hash</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.block_number"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.block_number</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.event_date"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.event_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropEvent.notes"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.notes</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter"><code class="docutils literal notranslate"><span class="pre">AirdropReporter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.enable_portfolio_analytics"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.enable_portfolio_analytics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.enable_roi_analysis"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.enable_roi_analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.export_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.export_report()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.generate_comprehensive_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.generate_comprehensive_report()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropReporter.generate_protocol_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.generate_protocol_report()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ReportFormat"><code class="docutils literal notranslate"><span class="pre">ReportFormat</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ReportFormat.JSON"><code class="docutils literal notranslate"><span class="pre">ReportFormat.JSON</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ReportFormat.CSV"><code class="docutils literal notranslate"><span class="pre">ReportFormat.CSV</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ReportFormat.CONSOLE"><code class="docutils literal notranslate"><span class="pre">ReportFormat.CONSOLE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer.__init__"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer.calculate_portfolio_roi"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.calculate_portfolio_roi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer.calculate_protocol_roi"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.calculate_protocol_roi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer.generate_optimization_suggestions"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.generate_optimization_suggestions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIOptimizer.set_protocol_cost_data"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.set_protocol_cost_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics"><code class="docutils literal notranslate"><span class="pre">ROIMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.model_config"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.protocol_name"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.total_revenue_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.total_revenue_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.total_cost_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.total_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.roi_percentage"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.roi_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.profit_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.profit_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.transaction_count"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.transaction_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.revenue_per_transaction"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.revenue_per_transaction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.cost_per_transaction"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.cost_per_transaction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.ROIMetrics.calculation_date"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.calculation_date</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.model_config"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.protocol_name"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.suggestion_type"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.suggestion_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.priority"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.priority</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.description"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.expected_impact"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.expected_impact</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.current_roi"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.current_roi</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationSuggestion.potential_roi"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.potential_roi</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData"><code class="docutils literal notranslate"><span class="pre">CostData</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.model_config"><code class="docutils literal notranslate"><span class="pre">CostData.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.protocol_name"><code class="docutils literal notranslate"><span class="pre">CostData.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.total_gas_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.total_gas_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.transaction_count"><code class="docutils literal notranslate"><span class="pre">CostData.transaction_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.average_gas_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.average_gas_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.manual_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.manual_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostData.time_investment_hours"><code class="docutils literal notranslate"><span class="pre">CostData.time_investment_hours</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostModel"><code class="docutils literal notranslate"><span class="pre">CostModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostModel.SIMPLE_GAS"><code class="docutils literal notranslate"><span class="pre">CostModel.SIMPLE_GAS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostModel.MANUAL_INPUT"><code class="docutils literal notranslate"><span class="pre">CostModel.MANUAL_INPUT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.CostModel.ESTIMATED"><code class="docutils literal notranslate"><span class="pre">CostModel.ESTIMATED</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationStrategy"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationStrategy.ROI_MAXIMIZATION"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.ROI_MAXIMIZATION</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationStrategy.RISK_ADJUSTED"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.RISK_ADJUSTED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OptimizationStrategy.DIVERSIFIED"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.DIVERSIFIED</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropPredictor"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropPredictor.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropPredictor.get_data_source_status"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.get_data_source_status()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropPredictor.predict_airdrop_timing"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.predict_airdrop_timing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.AirdropPredictor.update_prediction_model"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.update_prediction_model()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult"><code class="docutils literal notranslate"><span class="pre">PredictionResult</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.model_config"><code class="docutils literal notranslate"><span class="pre">PredictionResult.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.validate_protocol_name"><code class="docutils literal notranslate"><span class="pre">PredictionResult.validate_protocol_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.protocol_name"><code class="docutils literal notranslate"><span class="pre">PredictionResult.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.prediction_windows"><code class="docutils literal notranslate"><span class="pre">PredictionResult.prediction_windows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.confidence_level"><code class="docutils literal notranslate"><span class="pre">PredictionResult.confidence_level</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.model_version"><code class="docutils literal notranslate"><span class="pre">PredictionResult.model_version</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.data_sources_used"><code class="docutils literal notranslate"><span class="pre">PredictionResult.data_sources_used</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.prediction_date"><code class="docutils literal notranslate"><span class="pre">PredictionResult.prediction_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.next_review_date"><code class="docutils literal notranslate"><span class="pre">PredictionResult.next_review_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionResult.metadata"><code class="docutils literal notranslate"><span class="pre">PredictionResult.metadata</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow"><code class="docutils literal notranslate"><span class="pre">PredictionWindow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow.model_config"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow.validate_end_after_start"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.validate_end_after_start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow.start_date"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.start_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow.end_date"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.end_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionWindow.probability"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.probability</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionConfidence"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionConfidence.LOW"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.LOW</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionConfidence.MEDIUM"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.MEDIUM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PredictionConfidence.HIGH"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.HIGH</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.DataSourceType"><code class="docutils literal notranslate"><span class="pre">DataSourceType</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.DataSourceType.HISTORICAL_AIRDROPS"><code class="docutils literal notranslate"><span class="pre">DataSourceType.HISTORICAL_AIRDROPS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.DataSourceType.MARKET_DATA"><code class="docutils literal notranslate"><span class="pre">DataSourceType.MARKET_DATA</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.DataSourceType.ONCHAIN_ACTIVITY"><code class="docutils literal notranslate"><span class="pre">DataSourceType.ONCHAIN_ACTIVITY</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.DataSourceType.SOCIAL_SENTIMENT"><code class="docutils literal notranslate"><span class="pre">DataSourceType.SOCIAL_SENTIMENT</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.MarketDataStub"><code class="docutils literal notranslate"><span class="pre">MarketDataStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.MarketDataStub.get_token_price_history"><code class="docutils literal notranslate"><span class="pre">MarketDataStub.get_token_price_history()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OnChainActivityStub"><code class="docutils literal notranslate"><span class="pre">OnChainActivityStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.OnChainActivityStub.get_protocol_activity_metrics"><code class="docutils literal notranslate"><span class="pre">OnChainActivityStub.get_protocol_activity_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.SocialSentimentStub"><code class="docutils literal notranslate"><span class="pre">SocialSentimentStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.SocialSentimentStub.get_sentiment_score"><code class="docutils literal notranslate"><span class="pre">SocialSentimentStub.get_sentiment_score()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioPerformanceAnalyzer"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioPerformanceAnalyzer.__init__"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioPerformanceAnalyzer.calculate_portfolio_metrics"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.calculate_portfolio_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioPerformanceAnalyzer.calculate_portfolio_value_over_time"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.calculate_portfolio_value_over_time()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioPerformanceAnalyzer.compare_to_benchmark"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.compare_to_benchmark()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.model_config"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.calculation_date"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.calculation_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.total_portfolio_value_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_portfolio_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.total_profit_loss_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_profit_loss_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.total_cost_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.portfolio_roi_percentage"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.portfolio_roi_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.protocol_count"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.protocol_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.token_count"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.token_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.diversification_index"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.diversification_index</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.largest_position_percentage"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.largest_position_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioMetrics.value_at_risk_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.value_at_risk_usd</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.model_config"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.snapshot_date"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.snapshot_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.total_value_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.total_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.protocol_allocations"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.protocol_allocations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.token_allocations"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.token_allocations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.PortfolioSnapshot.diversification_score"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.diversification_score</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.model_config"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.model_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.benchmark_type"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.benchmark_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.portfolio_return_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.portfolio_return_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.benchmark_return_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.benchmark_return_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.alpha_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.alpha_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.comparison_period_days"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.comparison_period_days</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkComparison.calculation_date"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.calculation_date</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkType"><code class="docutils literal notranslate"><span class="pre">BenchmarkType</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkType.ETH"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.ETH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkType.BTC"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.BTC</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.BenchmarkType.MARKET_INDEX"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.MARKET_INDEX</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics.tracker">Airdrop Tracker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.Base"><code class="docutils literal notranslate"><span class="pre">Base</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.Base.__init__"><code class="docutils literal notranslate"><span class="pre">Base.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.Base.metadata"><code class="docutils literal notranslate"><span class="pre">Base.metadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.Base.registry"><code class="docutils literal notranslate"><span class="pre">Base.registry</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.id"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.protocol_name"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.token_symbol"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.token_symbol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.amount_received"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.amount_received</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.estimated_value_usd"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.estimated_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.wallet_address"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.wallet_address</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.transaction_hash"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.transaction_hash</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.block_number"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.block_number</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.event_date"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.event_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.created_at"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.notes"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.notes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEventModel.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropEventModel.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent"><code class="docutils literal notranslate"><span class="pre">AirdropEvent</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.protocol_name"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.token_symbol"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.token_symbol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.amount_received"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.amount_received</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.estimated_value_usd"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.estimated_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.wallet_address"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.wallet_address</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.transaction_hash"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.transaction_hash</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.block_number"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.block_number</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.event_date"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.event_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.notes"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.notes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.validate_protocol_name"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.validate_protocol_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.validate_token_symbol"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.validate_token_symbol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.ConfigDict"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.ConfigDict</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropEvent.model_config"><code class="docutils literal notranslate"><span class="pre">AirdropEvent.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker"><code class="docutils literal notranslate"><span class="pre">AirdropTracker</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker.record_airdrop"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.record_airdrop()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker.get_airdrops_by_protocol"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_protocol()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker.get_airdrops_by_wallet"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_wallet()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.tracker.AirdropTracker.get_airdrops_by_date_range"><code class="docutils literal notranslate"><span class="pre">AirdropTracker.get_airdrops_by_date_range()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics.reporter">Airdrop Reporter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ReportFormat"><code class="docutils literal notranslate"><span class="pre">ReportFormat</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ReportFormat.JSON"><code class="docutils literal notranslate"><span class="pre">ReportFormat.JSON</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ReportFormat.CSV"><code class="docutils literal notranslate"><span class="pre">ReportFormat.CSV</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ReportFormat.CONSOLE"><code class="docutils literal notranslate"><span class="pre">ReportFormat.CONSOLE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.protocol_name"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.total_events"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.total_events</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.total_tokens_received"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.total_tokens_received</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.total_estimated_value_usd"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.total_estimated_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.unique_tokens"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.unique_tokens</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.first_airdrop_date"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.first_airdrop_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.last_airdrop_date"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.last_airdrop_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.ProtocolSummary.model_config"><code class="docutils literal notranslate"><span class="pre">ProtocolSummary.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport"><code class="docutils literal notranslate"><span class="pre">AirdropReport</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.report_generated_at"><code class="docutils literal notranslate"><span class="pre">AirdropReport.report_generated_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.total_airdrops"><code class="docutils literal notranslate"><span class="pre">AirdropReport.total_airdrops</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.total_protocols"><code class="docutils literal notranslate"><span class="pre">AirdropReport.total_protocols</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.total_estimated_value_usd"><code class="docutils literal notranslate"><span class="pre">AirdropReport.total_estimated_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.date_range_start"><code class="docutils literal notranslate"><span class="pre">AirdropReport.date_range_start</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.date_range_end"><code class="docutils literal notranslate"><span class="pre">AirdropReport.date_range_end</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.protocol_summaries"><code class="docutils literal notranslate"><span class="pre">AirdropReport.protocol_summaries</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.top_protocols_by_value"><code class="docutils literal notranslate"><span class="pre">AirdropReport.top_protocols_by_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.monthly_breakdown"><code class="docutils literal notranslate"><span class="pre">AirdropReport.monthly_breakdown</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.roi_metrics"><code class="docutils literal notranslate"><span class="pre">AirdropReport.roi_metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.optimization_suggestions"><code class="docutils literal notranslate"><span class="pre">AirdropReport.optimization_suggestions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.portfolio_metrics"><code class="docutils literal notranslate"><span class="pre">AirdropReport.portfolio_metrics</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReport.model_config"><code class="docutils literal notranslate"><span class="pre">AirdropReport.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter"><code class="docutils literal notranslate"><span class="pre">AirdropReporter</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.enable_roi_analysis"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.enable_roi_analysis()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.enable_portfolio_analytics"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.enable_portfolio_analytics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.generate_comprehensive_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.generate_comprehensive_report()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.generate_protocol_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.generate_protocol_report()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.reporter.AirdropReporter.export_report"><code class="docutils literal notranslate"><span class="pre">AirdropReporter.export_report()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics.optimizer">ROI Optimizer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostModel"><code class="docutils literal notranslate"><span class="pre">CostModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostModel.SIMPLE_GAS"><code class="docutils literal notranslate"><span class="pre">CostModel.SIMPLE_GAS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostModel.MANUAL_INPUT"><code class="docutils literal notranslate"><span class="pre">CostModel.MANUAL_INPUT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostModel.ESTIMATED"><code class="docutils literal notranslate"><span class="pre">CostModel.ESTIMATED</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationStrategy"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationStrategy.ROI_MAXIMIZATION"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.ROI_MAXIMIZATION</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationStrategy.RISK_ADJUSTED"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.RISK_ADJUSTED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationStrategy.DIVERSIFIED"><code class="docutils literal notranslate"><span class="pre">OptimizationStrategy.DIVERSIFIED</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData"><code class="docutils literal notranslate"><span class="pre">CostData</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.protocol_name"><code class="docutils literal notranslate"><span class="pre">CostData.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.total_gas_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.total_gas_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.transaction_count"><code class="docutils literal notranslate"><span class="pre">CostData.transaction_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.average_gas_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.average_gas_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.manual_cost_usd"><code class="docutils literal notranslate"><span class="pre">CostData.manual_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.time_investment_hours"><code class="docutils literal notranslate"><span class="pre">CostData.time_investment_hours</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.CostData.model_config"><code class="docutils literal notranslate"><span class="pre">CostData.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics"><code class="docutils literal notranslate"><span class="pre">ROIMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.protocol_name"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.total_revenue_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.total_revenue_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.total_cost_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.total_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.roi_percentage"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.roi_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.profit_usd"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.profit_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.transaction_count"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.transaction_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.revenue_per_transaction"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.revenue_per_transaction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.cost_per_transaction"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.cost_per_transaction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.calculation_date"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.calculation_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIMetrics.model_config"><code class="docutils literal notranslate"><span class="pre">ROIMetrics.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.protocol_name"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.suggestion_type"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.suggestion_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.priority"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.priority</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.description"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.expected_impact"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.expected_impact</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.current_roi"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.current_roi</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.potential_roi"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.potential_roi</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.OptimizationSuggestion.model_config"><code class="docutils literal notranslate"><span class="pre">OptimizationSuggestion.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer.__init__"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer.set_protocol_cost_data"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.set_protocol_cost_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer.calculate_protocol_roi"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.calculate_protocol_roi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer.calculate_portfolio_roi"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.calculate_portfolio_roi()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.optimizer.ROIOptimizer.generate_optimization_suggestions"><code class="docutils literal notranslate"><span class="pre">ROIOptimizer.generate_optimization_suggestions()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics.portfolio">Portfolio Performance Analyzer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkType"><code class="docutils literal notranslate"><span class="pre">BenchmarkType</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkType.ETH"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.ETH</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkType.BTC"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.BTC</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkType.MARKET_INDEX"><code class="docutils literal notranslate"><span class="pre">BenchmarkType.MARKET_INDEX</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.snapshot_date"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.snapshot_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.total_value_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.total_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.protocol_allocations"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.protocol_allocations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.token_allocations"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.token_allocations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.diversification_score"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.diversification_score</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioSnapshot.model_config"><code class="docutils literal notranslate"><span class="pre">PortfolioSnapshot.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.calculation_date"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.calculation_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.total_portfolio_value_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_portfolio_value_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.total_profit_loss_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_profit_loss_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.total_cost_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.total_cost_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.portfolio_roi_percentage"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.portfolio_roi_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.protocol_count"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.protocol_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.token_count"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.token_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.diversification_index"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.diversification_index</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.largest_position_percentage"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.largest_position_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.value_at_risk_usd"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.value_at_risk_usd</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioMetrics.model_config"><code class="docutils literal notranslate"><span class="pre">PortfolioMetrics.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.benchmark_type"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.benchmark_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.portfolio_return_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.portfolio_return_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.benchmark_return_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.benchmark_return_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.alpha_percentage"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.alpha_percentage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.comparison_period_days"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.comparison_period_days</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.calculation_date"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.calculation_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.BenchmarkComparison.model_config"><code class="docutils literal notranslate"><span class="pre">BenchmarkComparison.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioPerformanceAnalyzer"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioPerformanceAnalyzer.__init__"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioPerformanceAnalyzer.calculate_portfolio_metrics"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.calculate_portfolio_metrics()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioPerformanceAnalyzer.calculate_portfolio_value_over_time"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.calculate_portfolio_value_over_time()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.portfolio.PortfolioPerformanceAnalyzer.compare_to_benchmark"><code class="docutils literal notranslate"><span class="pre">PortfolioPerformanceAnalyzer.compare_to_benchmark()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../analytics.html#module-airdrops.analytics.predictor">Airdrop Predictor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.DataSourceType"><code class="docutils literal notranslate"><span class="pre">DataSourceType</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.DataSourceType.HISTORICAL_AIRDROPS"><code class="docutils literal notranslate"><span class="pre">DataSourceType.HISTORICAL_AIRDROPS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.DataSourceType.MARKET_DATA"><code class="docutils literal notranslate"><span class="pre">DataSourceType.MARKET_DATA</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.DataSourceType.ONCHAIN_ACTIVITY"><code class="docutils literal notranslate"><span class="pre">DataSourceType.ONCHAIN_ACTIVITY</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.DataSourceType.SOCIAL_SENTIMENT"><code class="docutils literal notranslate"><span class="pre">DataSourceType.SOCIAL_SENTIMENT</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionConfidence"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionConfidence.LOW"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.LOW</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionConfidence.MEDIUM"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.MEDIUM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionConfidence.HIGH"><code class="docutils literal notranslate"><span class="pre">PredictionConfidence.HIGH</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow"><code class="docutils literal notranslate"><span class="pre">PredictionWindow</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow.start_date"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.start_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow.end_date"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.end_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow.probability"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.probability</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow.validate_end_after_start"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.validate_end_after_start()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionWindow.model_config"><code class="docutils literal notranslate"><span class="pre">PredictionWindow.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult"><code class="docutils literal notranslate"><span class="pre">PredictionResult</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.protocol_name"><code class="docutils literal notranslate"><span class="pre">PredictionResult.protocol_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.prediction_windows"><code class="docutils literal notranslate"><span class="pre">PredictionResult.prediction_windows</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.confidence_level"><code class="docutils literal notranslate"><span class="pre">PredictionResult.confidence_level</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.model_version"><code class="docutils literal notranslate"><span class="pre">PredictionResult.model_version</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.data_sources_used"><code class="docutils literal notranslate"><span class="pre">PredictionResult.data_sources_used</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.prediction_date"><code class="docutils literal notranslate"><span class="pre">PredictionResult.prediction_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.next_review_date"><code class="docutils literal notranslate"><span class="pre">PredictionResult.next_review_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.metadata"><code class="docutils literal notranslate"><span class="pre">PredictionResult.metadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.validate_protocol_name"><code class="docutils literal notranslate"><span class="pre">PredictionResult.validate_protocol_name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.PredictionResult.model_config"><code class="docutils literal notranslate"><span class="pre">PredictionResult.model_config</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.MarketDataStub"><code class="docutils literal notranslate"><span class="pre">MarketDataStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.MarketDataStub.get_token_price_history"><code class="docutils literal notranslate"><span class="pre">MarketDataStub.get_token_price_history()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.OnChainActivityStub"><code class="docutils literal notranslate"><span class="pre">OnChainActivityStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.OnChainActivityStub.get_protocol_activity_metrics"><code class="docutils literal notranslate"><span class="pre">OnChainActivityStub.get_protocol_activity_metrics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.SocialSentimentStub"><code class="docutils literal notranslate"><span class="pre">SocialSentimentStub</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.SocialSentimentStub.get_sentiment_score"><code class="docutils literal notranslate"><span class="pre">SocialSentimentStub.get_sentiment_score()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.AirdropPredictor"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.AirdropPredictor.__init__"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.AirdropPredictor.predict_airdrop_timing"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.predict_airdrop_timing()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.AirdropPredictor.get_data_source_status"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.get_data_source_status()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../analytics.html#airdrops.analytics.predictor.AirdropPredictor.update_prediction_model"><code class="docutils literal notranslate"><span class="pre">AirdropPredictor.update_prediction_model()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../shared.html">Shared Utilities API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../shared.html#module-airdrops.shared">Shared Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../shared.html#module-airdrops.shared.config">Configuration</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Airdrops Automation API Docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">airdrops.protocols.zksync.zksync</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for airdrops.protocols.zksync.zksync</h1><div class="highlight"><pre>
<span></span><span class="c1"># airdrops/src/airdrops/protocols/zksync/zksync.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">zkSync Era Protocol Module.</span>

<span class="sd">This module provides functionalities to interact with the zkSync Era network,</span>
<span class="sd">including bridging, DEX swaps, and lending protocol interactions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">web3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Web3</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">eth_account</span><span class="w"> </span><span class="kn">import</span> <span class="n">Account</span>

<span class="c1"># Configure logging for this module</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Placeholder for configuration, to be loaded dynamically</span>
<span class="n">CONFIG</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Constants</span>
<span class="n">L1_BRIDGE_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;0x32400084C286CF3E17e7B677ea9583e60a000324&quot;</span>
<span class="n">L2_BRIDGE_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;0x0000000000000000000000000000000000008006&quot;</span>
<span class="n">SYNCSWAP_ROUTER_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;0x2da10A1e27bF85cEdD8FFb1AbBe97e53391C0295&quot;</span>
<span class="n">NATIVE_ETH_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;0x0000000000000000000000000000000000000000&quot;</span>
<span class="n">DEFAULT_L2_GAS_LIMIT</span> <span class="o">=</span> <span class="mi">800000</span>
<span class="n">DEFAULT_L2_GAS_PER_PUBDATA_BYTE_LIMIT</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">DEFAULT_SLIPPAGE_BPS</span> <span class="o">=</span> <span class="mi">50</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_bridge_inputs</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount_eth</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate inputs for bridge_eth function.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        amount_eth: Amount of ETH to bridge</span>
<span class="sd">        config: Configuration dictionary</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_address</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">user_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid user address: </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_key</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid private key provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">amount_eth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Amount must be positive: </span><span class="si">{</span><span class="n">amount_eth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration dictionary is required&quot;</span><span class="p">)</span>

    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required config key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_web3_instance</span><span class="p">(</span><span class="n">rpc_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chain_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Web3</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and validate Web3 instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        rpc_url: RPC endpoint URL</span>
<span class="sd">        chain_name: Name of the chain for logging</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured Web3 instance</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If unable to connect to RPC</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">HTTPProvider</span><span class="p">(</span><span class="n">rpc_url</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w3</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to connect to </span><span class="si">{</span><span class="n">chain_name</span><span class="si">}</span><span class="s2"> RPC&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w3</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to </span><span class="si">{</span><span class="n">chain_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_estimate_l1_gas</span><span class="p">(</span>
    <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate gas for L1 transaction with safety multiplier.</span>

<span class="sd">    Args:</span>
<span class="sd">        contract_function: Web3 contract function</span>
<span class="sd">        transaction_params: Transaction parameters</span>
<span class="sd">        multiplier: Gas limit multiplier for safety</span>

<span class="sd">    Returns:</span>
<span class="sd">        Estimated gas limit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">estimated_gas</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">estimated_gas</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gas estimation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using default&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">200000</span>  <span class="c1"># Default fallback</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_build_l1_deposit_transaction</span><span class="p">(</span>
    <span class="n">w3_l1</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">bridge_contract</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_wei</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">l2_gas_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">l2_gas_per_pubdata</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build L1 to L2 deposit transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        w3_l1: Web3 instance for L1</span>
<span class="sd">        bridge_contract: L1 bridge contract instance</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        amount_wei: Amount in wei to bridge</span>
<span class="sd">        l2_gas_limit: L2 gas limit</span>
<span class="sd">        l2_gas_per_pubdata: L2 gas per pubdata byte limit</span>

<span class="sd">    Returns:</span>
<span class="sd">        Transaction dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get current gas price</span>
    <span class="n">gas_price</span> <span class="o">=</span> <span class="n">w3_l1</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span>

    <span class="c1"># Build transaction for requestL2Transaction</span>
    <span class="n">contract_function</span> <span class="o">=</span> <span class="n">bridge_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">requestL2Transaction</span><span class="p">(</span>
        <span class="n">user_address</span><span class="p">,</span>  <span class="c1"># _contractL2 (recipient on L2)</span>
        <span class="n">amount_wei</span><span class="p">,</span>  <span class="c1"># _l2Value</span>
        <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># _calldata (empty for simple ETH transfer)</span>
        <span class="n">l2_gas_limit</span><span class="p">,</span>  <span class="c1"># _l2GasLimit</span>
        <span class="n">l2_gas_per_pubdata</span><span class="p">,</span>  <span class="c1"># _l2GasPerPubdataByteLimit</span>
        <span class="p">[],</span>  <span class="c1"># _factoryDeps (empty)</span>
        <span class="n">user_address</span><span class="p">,</span>  <span class="c1"># _refundRecipient</span>
    <span class="p">)</span>

    <span class="c1"># Estimate L2 transaction cost</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">l2_cost</span> <span class="o">=</span> <span class="n">bridge_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">l2TransactionBaseCost</span><span class="p">(</span>
            <span class="n">gas_price</span><span class="p">,</span> <span class="n">l2_gas_limit</span><span class="p">,</span> <span class="n">l2_gas_per_pubdata</span>
        <span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Fallback calculation if l2TransactionBaseCost fails</span>
        <span class="n">l2_cost</span> <span class="o">=</span> <span class="n">gas_price</span> <span class="o">*</span> <span class="n">l2_gas_limit</span>

    <span class="n">total_value</span> <span class="o">=</span> <span class="n">amount_wei</span> <span class="o">+</span> <span class="n">l2_cost</span>

    <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">total_value</span><span class="p">,</span>
        <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">gas_price</span><span class="p">,</span>
        <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l1</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Estimate gas</span>
    <span class="n">gas_limit</span> <span class="o">=</span> <span class="n">_estimate_l1_gas</span><span class="p">(</span><span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">)</span>
    <span class="n">transaction_params</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gas_limit</span>

    <span class="c1"># Build the transaction</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transaction</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_build_l2_withdrawal_transaction</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span> <span class="n">bridge_contract</span><span class="p">,</span> <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount_wei</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build L2 to L1 withdrawal transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        w3_l2: Web3 instance for L2</span>
<span class="sd">        bridge_contract: L2 bridge contract instance</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        amount_wei: Amount in wei to withdraw</span>

<span class="sd">    Returns:</span>
<span class="sd">        Transaction dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build transaction for withdraw function</span>
    <span class="n">contract_function</span> <span class="o">=</span> <span class="n">bridge_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span>
        <span class="n">user_address</span><span class="p">,</span> <span class="n">amount_wei</span>  <span class="c1"># _l1Receiver  # amount (as msg.value)</span>
    <span class="p">)</span>

    <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">amount_wei</span><span class="p">,</span>
        <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
        <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Estimate gas for L2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">estimated_gas</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
        <span class="n">gas_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">estimated_gas</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># L2 gas multiplier</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">gas_limit</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Default L2 gas limit</span>

    <span class="n">transaction_params</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gas_limit</span>

    <span class="c1"># Build the transaction</span>
    <span class="n">transaction</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transaction</span>


<div class="viewcode-block" id="bridge_eth">
<a class="viewcode-back" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.bridge_eth">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">bridge_eth</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_eth</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
    <span class="n">to_l2</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bridge ETH between L1 (Ethereum) and L2 (zkSync Era).</span>

<span class="sd">    This function handles both L1-&gt;L2 deposits and L2-&gt;L1 withdrawal</span>
<span class="sd">    initiation for ETH on the zkSync Era network.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: The Ethereum address performing the bridge operation</span>
<span class="sd">        private_key: Private key for signing transactions (64+ chars)</span>
<span class="sd">        amount_eth: Amount of ETH to bridge (must be positive)</span>
<span class="sd">        to_l2: True for L1-&gt;L2 deposit, False for L2-&gt;L1 withdrawal</span>
<span class="sd">        config: Configuration dictionary containing network settings</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: For invalid inputs</span>
<span class="sd">        ConnectionError: For RPC connection issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;networks&quot;: {</span>
<span class="sd">        ...         &quot;ethereum&quot;: {</span>
<span class="sd">        ...             &quot;rpc_url&quot;: &quot;https://eth-mainnet.g.alchemy.com/...&quot;,</span>
<span class="sd">        ...             &quot;bridge_address&quot;: (</span>
<span class="sd">        ...                 &quot;0x32400084C286CF3E17e7B677ea9583e60a000324&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...         },</span>
<span class="sd">        ...         &quot;zksync&quot;: {</span>
<span class="sd">        ...             &quot;rpc_url&quot;: &quot;https://mainnet.era.zksync.io&quot;,</span>
<span class="sd">        ...             &quot;bridge_address&quot;: (</span>
<span class="sd">        ...                 &quot;0x0000000000000000000000000000000000008006&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; success, tx_hash = bridge_eth(</span>
<span class="sd">        ...     &quot;0x742d35Cc6634C0532925a3b8D4C9db96590c6C87&quot;,</span>
<span class="sd">        ...     &quot;0x&quot; + &quot;a&quot; * 64,</span>
<span class="sd">        ...     Decimal(&quot;0.1&quot;),</span>
<span class="sd">        ...     True,</span>
<span class="sd">        ...     config</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Input validation</span>
        <span class="n">_validate_bridge_inputs</span><span class="p">(</span><span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">amount_eth</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;Depositing to&quot;</span> <span class="k">if</span> <span class="n">to_l2</span> <span class="k">else</span> <span class="s2">&quot;Initiating withdrawal from&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2"> zkSync Era: </span><span class="si">{</span><span class="n">amount_eth</span><span class="si">}</span><span class="s2"> ETH for </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Convert amount to wei</span>
        <span class="n">amount_wei</span> <span class="o">=</span> <span class="n">Web3</span><span class="o">.</span><span class="n">to_wei</span><span class="p">(</span><span class="n">amount_eth</span><span class="p">,</span> <span class="s2">&quot;ether&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_l2</span><span class="p">:</span>
            <span class="c1"># L1 -&gt; L2 Deposit</span>
            <span class="k">return</span> <span class="n">_execute_l1_to_l2_deposit</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">amount_wei</span><span class="p">,</span> <span class="n">config</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># L2 -&gt; L1 Withdrawal</span>
            <span class="k">return</span> <span class="n">_execute_l2_to_l1_withdrawal</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">amount_wei</span><span class="p">,</span> <span class="n">config</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error in bridge_eth: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error in bridge_eth: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error in bridge_eth: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_execute_l1_to_l2_deposit</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount_wei</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute L1 to L2 deposit transaction.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get L1 configuration</span>
        <span class="n">l1_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;ethereum&quot;</span><span class="p">]</span>
        <span class="n">l1_rpc_url</span> <span class="o">=</span> <span class="n">l1_config</span><span class="p">[</span><span class="s2">&quot;rpc_url&quot;</span><span class="p">]</span>
        <span class="n">l1_bridge_addr</span> <span class="o">=</span> <span class="n">l1_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bridge_address&quot;</span><span class="p">,</span> <span class="n">L1_BRIDGE_ADDRESS</span><span class="p">)</span>

        <span class="c1"># Initialize L1 Web3</span>
        <span class="n">w3_l1</span> <span class="o">=</span> <span class="n">_get_web3_instance</span><span class="p">(</span><span class="n">l1_rpc_url</span><span class="p">,</span> <span class="s2">&quot;Ethereum L1&quot;</span><span class="p">)</span>

        <span class="c1"># Load L1 bridge contract (minimal ABI for requestL2Transaction)</span>
        <span class="n">l1_bridge_abi</span> <span class="o">=</span> <span class="n">_get_l1_bridge_abi</span><span class="p">()</span>
        <span class="n">bridge_contract</span> <span class="o">=</span> <span class="n">w3_l1</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">l1_bridge_addr</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">l1_bridge_abi</span><span class="p">)</span>

        <span class="c1"># Get L2 gas parameters from config or use defaults</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">l2_gas_limit</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;l2_gas_limit&quot;</span><span class="p">,</span> <span class="n">DEFAULT_L2_GAS_LIMIT</span><span class="p">)</span>
        <span class="n">l2_gas_per_pubdata</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;l2_gas_per_pubdata_byte_limit&quot;</span><span class="p">,</span> <span class="n">DEFAULT_L2_GAS_PER_PUBDATA_BYTE_LIMIT</span>
        <span class="p">)</span>

        <span class="c1"># Build transaction</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">_build_l1_deposit_transaction</span><span class="p">(</span>
            <span class="n">w3_l1</span><span class="p">,</span>
            <span class="n">bridge_contract</span><span class="p">,</span>
            <span class="n">user_address</span><span class="p">,</span>
            <span class="n">amount_wei</span><span class="p">,</span>
            <span class="n">l2_gas_limit</span><span class="p">,</span>
            <span class="n">l2_gas_per_pubdata</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Sign and send transaction</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3_l1</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
        <span class="n">tx_hash_hex</span> <span class="o">=</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

        <span class="c1"># Wait for transaction receipt</span>
        <span class="n">receipt</span> <span class="o">=</span> <span class="n">w3_l1</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">receipt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1-&gt;L2 deposit successful: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tx_hash_hex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1-&gt;L2 deposit failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in L1-&gt;L2 deposit: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L1-&gt;L2 deposit error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_l2_to_l1_withdrawal</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount_wei</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute L2 to L1 withdrawal initiation transaction.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get L2 configuration</span>
        <span class="n">l2_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;zksync&quot;</span><span class="p">]</span>
        <span class="n">l2_rpc_url</span> <span class="o">=</span> <span class="n">l2_config</span><span class="p">[</span><span class="s2">&quot;rpc_url&quot;</span><span class="p">]</span>
        <span class="n">l2_bridge_addr</span> <span class="o">=</span> <span class="n">l2_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bridge_address&quot;</span><span class="p">,</span> <span class="n">L2_BRIDGE_ADDRESS</span><span class="p">)</span>

        <span class="c1"># Initialize L2 Web3</span>
        <span class="n">w3_l2</span> <span class="o">=</span> <span class="n">_get_web3_instance</span><span class="p">(</span><span class="n">l2_rpc_url</span><span class="p">,</span> <span class="s2">&quot;zkSync Era L2&quot;</span><span class="p">)</span>

        <span class="c1"># Load L2 bridge contract (minimal ABI for withdraw)</span>
        <span class="n">l2_bridge_abi</span> <span class="o">=</span> <span class="n">_get_l2_bridge_abi</span><span class="p">()</span>
        <span class="n">bridge_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">l2_bridge_addr</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">l2_bridge_abi</span><span class="p">)</span>

        <span class="c1"># Build transaction</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">_build_l2_withdrawal_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">bridge_contract</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">amount_wei</span>
        <span class="p">)</span>

        <span class="c1"># Sign and send transaction</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
        <span class="n">tx_hash_hex</span> <span class="o">=</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

        <span class="c1"># Wait for transaction receipt</span>
        <span class="n">receipt</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">receipt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2-&gt;L1 withdrawal initiated: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tx_hash_hex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2-&gt;L1 withdrawal failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in L2-&gt;L1 withdrawal: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L2-&gt;L1 withdrawal error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_l1_bridge_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ABI for L1 bridge contract.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_contractL2&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l2Value&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_calldata&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l2GasLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l2GasPerPubdataByteLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_factoryDeps&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes[]&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_refundRecipient&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;requestL2Transaction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bytes32&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;payable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_gasPrice&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l2GasLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l2GasPerPubdataByteLimit&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;l2TransactionBaseCost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_l2_bridge_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ABI for L2 bridge contract.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;_l1Receiver&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;withdraw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;payable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_swap_inputs</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_in_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_out_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_in</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">dex_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">slippage_bps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate inputs for swap_tokens function.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        token_in_address: Address of input token</span>
<span class="sd">        token_out_address: Address of output token</span>
<span class="sd">        amount_in: Amount of input token in wei</span>
<span class="sd">        dex_name: Name of the DEX</span>
<span class="sd">        slippage_bps: Slippage tolerance in basis points</span>
<span class="sd">        config: Configuration dictionary</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_address</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">user_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid user address: </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_key</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid private key provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">token_in_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid token_in_address: </span><span class="si">{</span><span class="n">token_in_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">token_out_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid token_out_address: </span><span class="si">{</span><span class="n">token_out_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">amount_in</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Amount must be positive: </span><span class="si">{</span><span class="n">amount_in</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dex_name</span> <span class="ow">or</span> <span class="n">dex_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;syncswap&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported DEX: </span><span class="si">{</span><span class="n">dex_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">slippage_bps</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid slippage_bps: </span><span class="si">{</span><span class="n">slippage_bps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration dictionary is required&quot;</span><span class="p">)</span>

    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required config key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_determine_swap_path</span><span class="p">(</span>
    <span class="n">token_in_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token_out_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">weth_address</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the swap path for token exchange.</span>

<span class="sd">    Args:</span>
<span class="sd">        token_in_address: Address of input token</span>
<span class="sd">        token_out_address: Address of output token</span>
<span class="sd">        weth_address: Address of WETH token</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of token addresses representing the swap path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize addresses to lowercase for comparison</span>
    <span class="n">token_in</span> <span class="o">=</span> <span class="n">token_in_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">token_out</span> <span class="o">=</span> <span class="n">token_out_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">native_eth</span> <span class="o">=</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Direct swap if both tokens are not native ETH</span>
    <span class="k">if</span> <span class="n">token_in</span> <span class="o">!=</span> <span class="n">native_eth</span> <span class="ow">and</span> <span class="n">token_out</span> <span class="o">!=</span> <span class="n">native_eth</span><span class="p">:</span>
        <span class="c1"># Try direct path first, fallback to WETH if needed</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">token_in_address</span><span class="p">,</span> <span class="n">token_out_address</span><span class="p">]</span>

    <span class="c1"># ETH to token swap</span>
    <span class="k">if</span> <span class="n">token_in</span> <span class="o">==</span> <span class="n">native_eth</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">weth_address</span><span class="p">,</span> <span class="n">token_out_address</span><span class="p">]</span>

    <span class="c1"># Token to ETH swap</span>
    <span class="k">if</span> <span class="n">token_out</span> <span class="o">==</span> <span class="n">native_eth</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">token_in_address</span><span class="p">,</span> <span class="n">weth_address</span><span class="p">]</span>

    <span class="c1"># Should not reach here with valid inputs</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">token_in_address</span><span class="p">,</span> <span class="n">token_out_address</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_syncswap_router_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ABI for SyncSwap router contract.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amountIn&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amountOutMin&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address[]&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;deadline&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;swapExactTokensForTokens&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amounts&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256[]&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amountOutMin&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address[]&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;deadline&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;swapExactETHForTokens&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amounts&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256[]&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;payable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amountIn&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address[]&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;getAmountsOut&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amounts&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256[]&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_erc20_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ERC20 ABI for token interactions.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;spender&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;approve&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;spender&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;allowance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;account&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;balanceOf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>


<div class="viewcode-block" id="swap_tokens">
<a class="viewcode-back" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.swap_tokens">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">swap_tokens</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_in_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_out_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_in</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">dex_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">slippage_bps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Swap tokens on a specified DEX on zkSync Era.</span>

<span class="sd">    This function handles token swaps on zkSync Era DEXes, specifically</span>
<span class="sd">    targeting SyncSwap. It supports ETH-to-token, token-to-ETH, and</span>
<span class="sd">    token-to-token swaps with configurable slippage protection.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: The Ethereum address performing the swap</span>
<span class="sd">        private_key: Private key for signing transactions (64+ chars)</span>
<span class="sd">        token_in_address: Address of the token to swap from</span>
<span class="sd">        token_out_address: Address of the token to swap to</span>
<span class="sd">        amount_in: Amount of input token in wei (must be positive)</span>
<span class="sd">        dex_name: Name of the DEX to use (currently supports &quot;syncswap&quot;)</span>
<span class="sd">        slippage_bps: Slippage tolerance in basis points (0-10000)</span>
<span class="sd">        config: Configuration dictionary containing network settings</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: For invalid inputs</span>
<span class="sd">        ConnectionError: For RPC connection issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;networks&quot;: {</span>
<span class="sd">        ...         &quot;zksync&quot;: {</span>
<span class="sd">        ...             &quot;rpc_url&quot;: &quot;https://mainnet.era.zksync.io&quot;,</span>
<span class="sd">        ...             &quot;dex_router_address&quot;: (</span>
<span class="sd">        ...                 &quot;0x2da10A1e27bF85cEdD8FFb1AbBe97e53391C0295&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     &quot;tokens&quot;: {</span>
<span class="sd">        ...         &quot;WETH&quot;: {</span>
<span class="sd">        ...             &quot;address&quot;: &quot;0x5AEa5775959fBC2557Cc8789bC1bf90A239D9a91&quot;</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; success, tx_hash = swap_tokens(</span>
<span class="sd">        ...     &quot;0x742d35Cc6634C0532925a3b8D4C9db96590c6C87&quot;,</span>
<span class="sd">        ...     &quot;0x&quot; + &quot;a&quot; * 64,</span>
<span class="sd">        ...     &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="sd">        ...     &quot;0x3355df6D4c9C3035724Fd0e3914dE96A5a83aaf4&quot;,</span>
<span class="sd">        ...     1000000000000000000,</span>
<span class="sd">        ...     &quot;syncswap&quot;,</span>
<span class="sd">        ...     50,</span>
<span class="sd">        ...     config</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Input validation</span>
        <span class="n">_validate_swap_inputs</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span>
            <span class="n">private_key</span><span class="p">,</span>
            <span class="n">token_in_address</span><span class="p">,</span>
            <span class="n">token_out_address</span><span class="p">,</span>
            <span class="n">amount_in</span><span class="p">,</span>
            <span class="n">dex_name</span><span class="p">,</span>
            <span class="n">slippage_bps</span><span class="p">,</span>
            <span class="n">config</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Swapping </span><span class="si">{</span><span class="n">amount_in</span><span class="si">}</span><span class="s2"> wei of </span><span class="si">{</span><span class="n">token_in_address</span><span class="si">}</span><span class="s2"> for &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">token_out_address</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">dex_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Execute the swap based on DEX</span>
        <span class="k">if</span> <span class="n">dex_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;syncswap&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_syncswap_swap</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span>
                <span class="n">private_key</span><span class="p">,</span>
                <span class="n">token_in_address</span><span class="p">,</span>
                <span class="n">token_out_address</span><span class="p">,</span>
                <span class="n">amount_in</span><span class="p">,</span>
                <span class="n">slippage_bps</span><span class="p">,</span>
                <span class="n">config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unsupported DEX: </span><span class="si">{</span><span class="n">dex_name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error in swap_tokens: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error in swap_tokens: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error in swap_tokens: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_execute_syncswap_swap</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_in_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_out_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_in</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">slippage_bps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute token swap on SyncSwap DEX.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get L2 configuration</span>
        <span class="n">l2_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;zksync&quot;</span><span class="p">]</span>
        <span class="n">l2_rpc_url</span> <span class="o">=</span> <span class="n">l2_config</span><span class="p">[</span><span class="s2">&quot;rpc_url&quot;</span><span class="p">]</span>
        <span class="n">router_address</span> <span class="o">=</span> <span class="n">l2_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dex_router_address&quot;</span><span class="p">,</span> <span class="n">SYNCSWAP_ROUTER_ADDRESS</span><span class="p">)</span>

        <span class="c1"># Initialize L2 Web3</span>
        <span class="n">w3_l2</span> <span class="o">=</span> <span class="n">_get_web3_instance</span><span class="p">(</span><span class="n">l2_rpc_url</span><span class="p">,</span> <span class="s2">&quot;zkSync Era L2&quot;</span><span class="p">)</span>

        <span class="c1"># Get WETH address from config</span>
        <span class="n">weth_address</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WETH&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;0x5AEa5775959fBC2557Cc8789bC1bf90A239D9a91&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Determine swap path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_determine_swap_path</span><span class="p">(</span><span class="n">token_in_address</span><span class="p">,</span> <span class="n">token_out_address</span><span class="p">,</span> <span class="n">weth_address</span><span class="p">)</span>

        <span class="c1"># Load router contract</span>
        <span class="n">router_abi</span> <span class="o">=</span> <span class="n">_get_syncswap_router_abi</span><span class="p">()</span>
        <span class="n">router_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">router_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">router_abi</span><span class="p">)</span>

        <span class="c1"># Handle token approval if needed (non-ETH input)</span>
        <span class="k">if</span> <span class="n">token_in_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">approval_success</span> <span class="o">=</span> <span class="n">_handle_token_approval</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span>
                <span class="n">user_address</span><span class="p">,</span>
                <span class="n">private_key</span><span class="p">,</span>
                <span class="n">token_in_address</span><span class="p">,</span>
                <span class="n">router_address</span><span class="p">,</span>
                <span class="n">amount_in</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">approval_success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Token approval failed&quot;</span>

        <span class="c1"># Get expected output amount and calculate minimum</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">amounts_out</span> <span class="o">=</span> <span class="n">router_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">getAmountsOut</span><span class="p">(</span>
                <span class="n">amount_in</span><span class="p">,</span> <span class="n">path</span>
            <span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
            <span class="n">expected_amount_out</span> <span class="o">=</span> <span class="n">amounts_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get amounts out: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to get expected output amount: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">amount_out_min</span> <span class="o">=</span> <span class="n">expected_amount_out</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10000</span> <span class="o">-</span> <span class="n">slippage_bps</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10000</span>

        <span class="c1"># Calculate deadline (5 minutes from now)</span>
        <span class="n">deadline</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="s2">&quot;latest&quot;</span><span class="p">)[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">300</span>

        <span class="c1"># Build and execute swap transaction</span>
        <span class="k">return</span> <span class="n">_build_and_send_swap_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span>
            <span class="n">router_contract</span><span class="p">,</span>
            <span class="n">user_address</span><span class="p">,</span>
            <span class="n">private_key</span><span class="p">,</span>
            <span class="n">token_in_address</span><span class="p">,</span>
            <span class="n">amount_in</span><span class="p">,</span>
            <span class="n">amount_out_min</span><span class="p">,</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="n">deadline</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in SyncSwap swap execution: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;SyncSwap swap error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<div class="viewcode-block" id="lend_borrow">
<a class="viewcode-back" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.lend_borrow">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lend_borrow</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">lending_protocol_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">collateral_status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interact with a lending protocol on zkSync Era (EraLend).</span>

<span class="sd">    This function handles interactions with EraLend protocol, supporting</span>
<span class="sd">    supply, withdraw, borrow, repay, and set_collateral actions.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: The Ethereum address performing the lending action</span>
<span class="sd">        private_key: Private key for signing transactions (64+ chars)</span>
<span class="sd">        action: Action to perform: &quot;supply&quot;, &quot;withdraw&quot;, &quot;borrow&quot;, &quot;repay&quot;,</span>
<span class="sd">                &quot;set_collateral&quot;</span>
<span class="sd">        token_address: Address of the underlying token (ETH as zero address)</span>
<span class="sd">        amount: Amount of token in wei (ignored for set_collateral)</span>
<span class="sd">        lending_protocol_name: Name of lending protocol (e.g., &quot;eralend&quot;)</span>
<span class="sd">        config: Configuration dictionary containing network and protocol</span>
<span class="sd">                settings</span>
<span class="sd">        collateral_status: For set_collateral action, True to enable,</span>
<span class="sd">                          False to disable</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: For invalid inputs</span>
<span class="sd">        ConnectionError: For RPC connection issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;networks&quot;: {</span>
<span class="sd">        ...         &quot;zksync&quot;: {</span>
<span class="sd">        ...             &quot;rpc_url&quot;: &quot;https://mainnet.era.zksync.io&quot;,</span>
<span class="sd">        ...             &quot;lending_protocols&quot;: {</span>
<span class="sd">        ...                 &quot;eralend&quot;: {</span>
<span class="sd">        ...                     &quot;lending_pool_manager&quot;: &quot;0x...&quot;,</span>
<span class="sd">        ...                     &quot;weth_gateway&quot;: &quot;0x...&quot;,</span>
<span class="sd">        ...                     &quot;supported_assets&quot;: {</span>
<span class="sd">        ...                         &quot;ETH&quot;: {</span>
<span class="sd">        ...                             &quot;address&quot;: (</span>
<span class="sd">        ...                                 &quot;0x0000000000000000000000000000000000000000&quot;  # noqa: E501</span>
<span class="sd">        ...                             ),</span>
<span class="sd">        ...                             &quot;ztoken_address&quot;: &quot;0x...&quot;</span>
<span class="sd">        ...                         }</span>
<span class="sd">        ...                     }</span>
<span class="sd">        ...                 }</span>
<span class="sd">        ...             }</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; success, tx_hash = lend_borrow(</span>
<span class="sd">        ...     &quot;0x742d35Cc6634C0532925a3b8D4C9db96590c6C87&quot;,</span>
<span class="sd">        ...     &quot;0x&quot; + &quot;a&quot; * 64,</span>
<span class="sd">        ...     &quot;supply&quot;,</span>
<span class="sd">        ...     &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="sd">        ...     1000000000000000000,</span>
<span class="sd">        ...     &quot;eralend&quot;,</span>
<span class="sd">        ...     config</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Input validation</span>
        <span class="n">_validate_lend_borrow_inputs</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span>
            <span class="n">private_key</span><span class="p">,</span>
            <span class="n">action</span><span class="p">,</span>
            <span class="n">token_address</span><span class="p">,</span>
            <span class="n">amount</span><span class="p">,</span>
            <span class="n">lending_protocol_name</span><span class="p">,</span>
            <span class="n">config</span><span class="p">,</span>
            <span class="n">collateral_status</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Executing </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> wei of </span><span class="si">{</span><span class="n">token_address</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;on </span><span class="si">{</span><span class="n">lending_protocol_name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Execute the lending action</span>
        <span class="k">return</span> <span class="n">_execute_lending_action</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span>
            <span class="n">private_key</span><span class="p">,</span>
            <span class="n">action</span><span class="p">,</span>
            <span class="n">token_address</span><span class="p">,</span>
            <span class="n">amount</span><span class="p">,</span>
            <span class="n">lending_protocol_name</span><span class="p">,</span>
            <span class="n">config</span><span class="p">,</span>
            <span class="n">collateral_status</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error in lend_borrow: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error in lend_borrow: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error in lend_borrow: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_validate_lend_borrow_inputs</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">lending_protocol_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">collateral_status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate inputs for lend_borrow function.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        action: Lending action to perform</span>
<span class="sd">        token_address: Token contract address</span>
<span class="sd">        amount: Amount in wei</span>
<span class="sd">        lending_protocol_name: Name of lending protocol</span>
<span class="sd">        config: Configuration dictionary</span>
<span class="sd">        collateral_status: Collateral status for set_collateral action</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any input is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_address</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">user_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid user address: </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">private_key</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid private key provided&quot;</span><span class="p">)</span>

    <span class="n">valid_actions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;supply&quot;</span><span class="p">,</span> <span class="s2">&quot;withdraw&quot;</span><span class="p">,</span> <span class="s2">&quot;borrow&quot;</span><span class="p">,</span> <span class="s2">&quot;repay&quot;</span><span class="p">,</span> <span class="s2">&quot;set_collateral&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_actions</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid action: </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">. Must be one of </span><span class="si">{</span><span class="n">valid_actions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Web3</span><span class="o">.</span><span class="n">is_address</span><span class="p">(</span><span class="n">token_address</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid token_address: </span><span class="si">{</span><span class="n">token_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">!=</span> <span class="s2">&quot;set_collateral&quot;</span> <span class="ow">and</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Amount must be positive: </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;set_collateral&quot;</span> <span class="ow">and</span> <span class="n">collateral_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;collateral_status required for set_collateral action&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">lending_protocol_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;lending_protocol_name is required&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration dictionary is required&quot;</span><span class="p">)</span>

    <span class="c1"># Validate config structure</span>
    <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required config key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;zksync&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing zksync network configuration&quot;</span><span class="p">)</span>

    <span class="n">zksync_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;zksync&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;lending_protocols&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zksync_config</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing lending_protocols in zksync configuration&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lending_protocol_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zksync_config</span><span class="p">[</span><span class="s2">&quot;lending_protocols&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Protocol </span><span class="si">{</span><span class="n">lending_protocol_name</span><span class="si">}</span><span class="s2"> not configured&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_lending_action</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">lending_protocol_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">collateral_status</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the specified lending action.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        private_key: Private key for signing</span>
<span class="sd">        action: Lending action to perform</span>
<span class="sd">        token_address: Token contract address</span>
<span class="sd">        amount: Amount in wei</span>
<span class="sd">        lending_protocol_name: Name of lending protocol</span>
<span class="sd">        config: Configuration dictionary</span>
<span class="sd">        collateral_status: Collateral status for set_collateral</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get L2 configuration</span>
        <span class="n">l2_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;zksync&quot;</span><span class="p">]</span>
        <span class="n">l2_rpc_url</span> <span class="o">=</span> <span class="n">l2_config</span><span class="p">[</span><span class="s2">&quot;rpc_url&quot;</span><span class="p">]</span>

        <span class="c1"># Initialize L2 Web3</span>
        <span class="n">w3_l2</span> <span class="o">=</span> <span class="n">_get_web3_instance</span><span class="p">(</span><span class="n">l2_rpc_url</span><span class="p">,</span> <span class="s2">&quot;zkSync Era L2&quot;</span><span class="p">)</span>

        <span class="c1"># Get protocol configuration</span>
        <span class="n">protocol_config</span> <span class="o">=</span> <span class="n">l2_config</span><span class="p">[</span><span class="s2">&quot;lending_protocols&quot;</span><span class="p">][</span><span class="n">lending_protocol_name</span><span class="p">]</span>

        <span class="c1"># Route to specific action handler</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;supply&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_supply_action</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">protocol_config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;withdraw&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_withdraw_action</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">protocol_config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;borrow&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_borrow_action</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">protocol_config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;repay&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_repay_action</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">protocol_config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;set_collateral&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_execute_set_collateral_action</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span>
                <span class="n">user_address</span><span class="p">,</span>
                <span class="n">private_key</span><span class="p">,</span>
                <span class="n">token_address</span><span class="p">,</span>
                <span class="n">collateral_status</span><span class="p">,</span>
                <span class="n">protocol_config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unsupported action: </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing lending action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Lending action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_supply_action</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">protocol_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute supply action on EraLend.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">is_eth</span> <span class="o">=</span> <span class="n">token_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_eth</span><span class="p">:</span>
            <span class="c1"># Use WETH Gateway for ETH deposits</span>
            <span class="n">gateway_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weth_gateway&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gateway_address</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;WETH Gateway address not configured&quot;</span>

            <span class="n">gateway_abi</span> <span class="o">=</span> <span class="n">_get_eralend_weth_gateway_abi</span><span class="p">()</span>
            <span class="n">gateway_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="n">gateway_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">gateway_abi</span>
            <span class="p">)</span>

            <span class="c1"># Build depositETH transaction</span>
            <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>
            <span class="n">referral_code</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;referral_code&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">gateway_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">depositETH</span><span class="p">(</span>
                <span class="n">pool_address</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">referral_code</span>
            <span class="p">)</span>

            <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ERC20 token supply</span>
            <span class="c1"># First approve the lending pool manager</span>
            <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>
            <span class="n">approval_success</span> <span class="o">=</span> <span class="n">_handle_token_approval</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">pool_address</span><span class="p">,</span> <span class="n">amount</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">approval_success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Token approval failed&quot;</span>

            <span class="c1"># Call supply function on lending pool manager</span>
            <span class="n">pool_abi</span> <span class="o">=</span> <span class="n">_get_eralend_lending_pool_abi</span><span class="p">()</span>
            <span class="n">pool_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">pool_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">pool_abi</span><span class="p">)</span>

            <span class="n">referral_code</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;referral_code&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">pool_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">supply</span><span class="p">(</span>
                <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">referral_code</span>
            <span class="p">)</span>

            <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
                <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">_build_and_send_lending_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in supply action: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Supply action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_withdraw_action</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">protocol_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute withdraw action on EraLend.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">is_eth</span> <span class="o">=</span> <span class="n">token_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_eth</span><span class="p">:</span>
            <span class="c1"># Use WETH Gateway for ETH withdrawals</span>
            <span class="n">gateway_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weth_gateway&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gateway_address</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;WETH Gateway address not configured&quot;</span>

            <span class="n">gateway_abi</span> <span class="o">=</span> <span class="n">_get_eralend_weth_gateway_abi</span><span class="p">()</span>
            <span class="n">gateway_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="n">gateway_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">gateway_abi</span>
            <span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">gateway_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">withdrawETH</span><span class="p">(</span>
                <span class="n">pool_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">user_address</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ERC20 token withdrawal</span>
            <span class="n">pool_abi</span> <span class="o">=</span> <span class="n">_get_eralend_lending_pool_abi</span><span class="p">()</span>
            <span class="n">pool_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">pool_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">pool_abi</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">pool_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span>
                <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">user_address</span>
            <span class="p">)</span>

        <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
            <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_build_and_send_lending_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in withdraw action: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Withdraw action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_borrow_action</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">protocol_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute borrow action on EraLend.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">is_eth</span> <span class="o">=</span> <span class="n">token_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_eth</span><span class="p">:</span>
            <span class="c1"># Use WETH Gateway for ETH borrowing</span>
            <span class="n">gateway_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weth_gateway&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gateway_address</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;WETH Gateway address not configured&quot;</span>

            <span class="n">gateway_abi</span> <span class="o">=</span> <span class="n">_get_eralend_weth_gateway_abi</span><span class="p">()</span>
            <span class="n">gateway_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="n">gateway_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">gateway_abi</span>
            <span class="p">)</span>

            <span class="n">interest_rate_mode</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interest_rate_mode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">referral_code</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;referral_code&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">gateway_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">borrowETH</span><span class="p">(</span>
                <span class="n">pool_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">interest_rate_mode</span><span class="p">,</span> <span class="n">referral_code</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ERC20 token borrowing</span>
            <span class="n">pool_abi</span> <span class="o">=</span> <span class="n">_get_eralend_lending_pool_abi</span><span class="p">()</span>
            <span class="n">pool_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">pool_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">pool_abi</span><span class="p">)</span>

            <span class="n">interest_rate_mode</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interest_rate_mode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">referral_code</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;referral_code&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">pool_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">borrow</span><span class="p">(</span>
                <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">interest_rate_mode</span><span class="p">,</span> <span class="n">referral_code</span><span class="p">,</span> <span class="n">user_address</span>
            <span class="p">)</span>

        <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
            <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_build_and_send_lending_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in borrow action: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Borrow action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_repay_action</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">protocol_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute repay action on EraLend.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">is_eth</span> <span class="o">=</span> <span class="n">token_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">is_eth</span><span class="p">:</span>
            <span class="c1"># Use WETH Gateway for ETH repayment</span>
            <span class="n">gateway_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weth_gateway&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gateway_address</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;WETH Gateway address not configured&quot;</span>

            <span class="n">gateway_abi</span> <span class="o">=</span> <span class="n">_get_eralend_weth_gateway_abi</span><span class="p">()</span>
            <span class="n">gateway_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span>
                <span class="n">address</span><span class="o">=</span><span class="n">gateway_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">gateway_abi</span>
            <span class="p">)</span>

            <span class="n">interest_rate_mode</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interest_rate_mode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">gateway_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">repayETH</span><span class="p">(</span>
                <span class="n">pool_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">interest_rate_mode</span><span class="p">,</span> <span class="n">user_address</span>
            <span class="p">)</span>

            <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ERC20 token repayment</span>
            <span class="c1"># First approve the lending pool manager</span>
            <span class="n">approval_success</span> <span class="o">=</span> <span class="n">_handle_token_approval</span><span class="p">(</span>
                <span class="n">w3_l2</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">token_address</span><span class="p">,</span> <span class="n">pool_address</span><span class="p">,</span> <span class="n">amount</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">approval_success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Token approval failed&quot;</span>

            <span class="n">pool_abi</span> <span class="o">=</span> <span class="n">_get_eralend_lending_pool_abi</span><span class="p">()</span>
            <span class="n">pool_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">pool_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">pool_abi</span><span class="p">)</span>

            <span class="n">interest_rate_mode</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interest_rate_mode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">pool_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">repay</span><span class="p">(</span>
                <span class="n">token_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">interest_rate_mode</span><span class="p">,</span> <span class="n">user_address</span>
            <span class="p">)</span>

            <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
                <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
                <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">_build_and_send_lending_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in repay action: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Repay action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_set_collateral_action</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">collateral_status</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">protocol_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute set collateral action on EraLend.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pool_address</span> <span class="o">=</span> <span class="n">protocol_config</span><span class="p">[</span><span class="s2">&quot;lending_pool_manager&quot;</span><span class="p">]</span>
        <span class="n">pool_abi</span> <span class="o">=</span> <span class="n">_get_eralend_lending_pool_abi</span><span class="p">()</span>
        <span class="n">pool_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">pool_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">pool_abi</span><span class="p">)</span>

        <span class="n">contract_function</span> <span class="o">=</span> <span class="n">pool_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">setUserUseReserveAsCollateral</span><span class="p">(</span>
            <span class="n">token_address</span><span class="p">,</span> <span class="n">collateral_status</span>
        <span class="p">)</span>

        <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
            <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_build_and_send_lending_transaction</span><span class="p">(</span>
            <span class="n">w3_l2</span><span class="p">,</span> <span class="n">contract_function</span><span class="p">,</span> <span class="n">transaction_params</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in set collateral action: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Set collateral action error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<div class="viewcode-block" id="perform_random_activity">
<a class="viewcode-back" href="../../../../protocols.html#airdrops.protocols.zksync.zksync.perform_random_activity">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">perform_random_activity</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a randomized sequence of zkSync Era activities.</span>

<span class="sd">    This function orchestrates a randomized sequence of zkSync Era actions</span>
<span class="sd">    (bridge_eth, swap_tokens, lend_borrow) based on configuration. It simulates</span>
<span class="sd">    diverse, human-like on-chain activity for airdrop farming.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: The Ethereum address performing random activities</span>
<span class="sd">        private_key: Private key for signing transactions (64+ chars)</span>
<span class="sd">        config: Configuration dictionary including random_activity section</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (overall_success: bool, summary_message: str)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: For invalid inputs or configuration</span>
<span class="sd">        ConnectionError: For RPC connection issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;networks&quot;: {&quot;zksync&quot;: {</span>
<span class="sd">        ...         &quot;rpc_url&quot;: &quot;https://mainnet.era.zksync.io&quot;}},</span>
<span class="sd">        ...     &quot;tokens&quot;: {&quot;ETH&quot;: {</span>
<span class="sd">        ...         &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;}},</span>
<span class="sd">        ...     &quot;random_activity&quot;: {</span>
<span class="sd">        ...         &quot;enabled&quot;: True,</span>
<span class="sd">        ...         &quot;num_actions_range&quot;: [2, 4],</span>
<span class="sd">        ...         &quot;action_weights&quot;: {&quot;bridge_eth&quot;: 30, &quot;swap_tokens&quot;: 50,</span>
<span class="sd">        ...                            &quot;lend_borrow&quot;: 20}</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; success, summary = perform_random_activity(</span>
<span class="sd">        ...     &quot;0x742d35Cc6634C0532925a3b8D4C9db96590c6C87&quot;,</span>
<span class="sd">        ...     &quot;0x&quot; + &quot;a&quot; * 64,</span>
<span class="sd">        ...     config</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting random activity sequence for </span><span class="si">{</span><span class="n">user_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Validate inputs and configuration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_validate_random_activity_config</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Invalid random_activity configuration&quot;</span>

        <span class="n">random_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;random_activity&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Random activity disabled in configuration&quot;</span>

        <span class="c1"># Initialize state tracking</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">_get_initial_onchain_state</span><span class="p">(</span><span class="n">user_address</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Failed to fetch initial on-chain state&quot;</span>

        <span class="c1"># Determine number of actions to perform</span>
        <span class="n">num_actions_range</span> <span class="o">=</span> <span class="n">random_config</span><span class="p">[</span><span class="s2">&quot;num_actions_range&quot;</span><span class="p">]</span>
        <span class="n">num_total_actions</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">num_actions_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_actions_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Planning to execute </span><span class="si">{</span><span class="n">num_total_actions</span><span class="si">}</span><span class="s2"> random actions&quot;</span><span class="p">)</span>

        <span class="c1"># Execute action sequence</span>
        <span class="k">return</span> <span class="n">_execute_action_sequence</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">num_total_actions</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validation error in perform_random_activity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error in perform_random_activity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error in perform_random_activity: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_handle_token_approval</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">spender_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle token approval for DEX router if needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        w3_l2: Web3 instance for L2</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        private_key: Private key for signing</span>
<span class="sd">        token_address: Token contract address</span>
<span class="sd">        spender_address: Address to approve (router)</span>
<span class="sd">        amount: Amount to approve</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if approval successful or not needed, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load token contract</span>
        <span class="n">erc20_abi</span> <span class="o">=</span> <span class="n">_get_erc20_abi</span><span class="p">()</span>
        <span class="n">token_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">token_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">erc20_abi</span><span class="p">)</span>

        <span class="c1"># Check current allowance</span>
        <span class="n">current_allowance</span> <span class="o">=</span> <span class="n">token_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">allowance</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span> <span class="n">spender_address</span>
        <span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">current_allowance</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sufficient allowance: </span><span class="si">{</span><span class="n">current_allowance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Need to approve</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Approving </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> tokens for </span><span class="si">{</span><span class="n">spender_address</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Build approval transaction</span>
        <span class="n">approve_function</span> <span class="o">=</span> <span class="n">token_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">approve</span><span class="p">(</span><span class="n">spender_address</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>

        <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
            <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Estimate gas</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">estimated_gas</span> <span class="o">=</span> <span class="n">approve_function</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">estimated_gas</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># L2 gas multiplier</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Default gas limit</span>

        <span class="n">transaction_params</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gas_limit</span>

        <span class="c1"># Build and sign transaction</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">approve_function</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="c1"># Send transaction</span>
        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
        <span class="n">receipt</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">receipt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token approval successful: </span><span class="si">{</span><span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Token approval failed: </span><span class="si">{</span><span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in token approval: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_build_and_send_swap_transaction</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">router_contract</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">token_in_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">amount_in</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">amount_out_min</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">deadline</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and send the swap transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        w3_l2: Web3 instance for L2</span>
<span class="sd">        router_contract: Router contract instance</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        private_key: Private key for signing</span>
<span class="sd">        token_in_address: Input token address</span>
<span class="sd">        amount_in: Input amount in wei</span>
<span class="sd">        amount_out_min: Minimum output amount</span>
<span class="sd">        path: Swap path</span>
<span class="sd">        deadline: Transaction deadline</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Determine if this is an ETH swap</span>
        <span class="n">is_eth_input</span> <span class="o">=</span> <span class="n">token_in_address</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">NATIVE_ETH_ADDRESS</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Build transaction based on input type</span>
        <span class="k">if</span> <span class="n">is_eth_input</span><span class="p">:</span>
            <span class="c1"># ETH to token swap</span>
            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">router_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">swapExactETHForTokens</span><span class="p">(</span>
                <span class="n">amount_out_min</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">deadline</span>
            <span class="p">)</span>
            <span class="n">msg_value</span> <span class="o">=</span> <span class="n">amount_in</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Token to token/ETH swap</span>
            <span class="n">contract_function</span> <span class="o">=</span> <span class="n">router_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">swapExactTokensForTokens</span><span class="p">(</span>
                <span class="n">amount_in</span><span class="p">,</span> <span class="n">amount_out_min</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">deadline</span>
            <span class="p">)</span>
            <span class="n">msg_value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Build transaction parameters</span>
        <span class="n">transaction_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">user_address</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">msg_value</span><span class="p">,</span>
            <span class="s2">&quot;gasPrice&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span><span class="p">,</span>
            <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">user_address</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Estimate gas</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">estimated_gas</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">estimated_gas</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># L2 gas multiplier</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gas estimation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using default&quot;</span><span class="p">)</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="mi">300000</span>  <span class="c1"># Default gas limit for swaps</span>

        <span class="n">transaction_params</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gas_limit</span>

        <span class="c1"># Build transaction</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>

        <span class="c1"># Sign and send transaction</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
        <span class="n">tx_hash_hex</span> <span class="o">=</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

        <span class="c1"># Wait for transaction receipt</span>
        <span class="n">receipt</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">receipt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Swap transaction successful: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tx_hash_hex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Swap transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in swap transaction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Swap transaction error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_build_and_send_lending_transaction</span><span class="p">(</span>
    <span class="n">w3_l2</span><span class="p">:</span> <span class="n">Web3</span><span class="p">,</span>
    <span class="n">contract_function</span><span class="p">,</span>
    <span class="n">transaction_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and send lending transaction.</span>

<span class="sd">    Args:</span>
<span class="sd">        w3_l2: Web3 instance for L2</span>
<span class="sd">        contract_function: Contract function to call</span>
<span class="sd">        transaction_params: Transaction parameters</span>
<span class="sd">        user_address: User&#39;s address</span>
<span class="sd">        private_key: Private key for signing</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (success: bool, message_or_tx_hash: str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Estimate gas</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">estimated_gas</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">estimate_gas</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">estimated_gas</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># L2 gas multiplier</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gas estimation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using default&quot;</span><span class="p">)</span>
            <span class="n">gas_limit</span> <span class="o">=</span> <span class="mi">300000</span>  <span class="c1"># Default gas limit for lending operations</span>

        <span class="n">transaction_params</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gas_limit</span>

        <span class="c1"># Build transaction</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="n">contract_function</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">(</span><span class="n">transaction_params</span><span class="p">)</span>

        <span class="c1"># Sign and send transaction</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">from_key</span><span class="p">(</span><span class="n">private_key</span><span class="p">)</span>
        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
        <span class="n">tx_hash_hex</span> <span class="o">=</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>

        <span class="c1"># Wait for transaction receipt</span>
        <span class="n">receipt</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">receipt</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lending transaction successful: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tx_hash_hex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lending transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Transaction failed: </span><span class="si">{</span><span class="n">tx_hash_hex</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in lending transaction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Lending transaction error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_eralend_lending_pool_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ABI for EraLend Lending Pool Manager contract.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;onBehalfOf&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;referralCode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;supply&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;withdraw&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;interestRateMode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;referralCode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;onBehalfOf&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;borrow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rateMode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;onBehalfOf&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;repay&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;useAsCollateral&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;setUserUseReserveAsCollateral&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_eralend_weth_gateway_abi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get minimal ABI for EraLend WETH Gateway contract.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lendingPool&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;onBehalfOf&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;referralCode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;depositETH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;payable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lendingPool&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;withdrawETH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lendingPool&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;interestRateMode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;referralCode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint16&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;borrowETH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lendingPool&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;rateMode&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;onBehalfOf&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;address&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;repayETH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
            <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;payable&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_random_activity_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate random_activity configuration structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: Configuration dictionary to validate</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if configuration is valid, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;random_activity&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Missing random_activity section in config&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">random_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;random_activity&quot;</span><span class="p">]</span>
        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="s2">&quot;num_actions_range&quot;</span><span class="p">,</span> <span class="s2">&quot;action_weights&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">random_config</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required key in random_activity: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Validate num_actions_range</span>
        <span class="n">num_range</span> <span class="o">=</span> <span class="n">random_config</span><span class="p">[</span><span class="s2">&quot;num_actions_range&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_range</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
            <span class="ow">or</span> <span class="n">num_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
            <span class="ow">or</span> <span class="n">num_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">num_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid num_actions_range format&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Validate action_weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">random_config</span><span class="p">[</span><span class="s2">&quot;action_weights&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid action_weights format&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error validating random_activity config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_initial_onchain_state</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch initial L2 balances and lending positions.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        config: Configuration dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing initial state or None if failed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get L2 configuration</span>
        <span class="n">l2_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;networks&quot;</span><span class="p">][</span><span class="s2">&quot;zksync&quot;</span><span class="p">]</span>
        <span class="n">l2_rpc_url</span> <span class="o">=</span> <span class="n">l2_config</span><span class="p">[</span><span class="s2">&quot;rpc_url&quot;</span><span class="p">]</span>

        <span class="c1"># Initialize L2 Web3</span>
        <span class="n">w3_l2</span> <span class="o">=</span> <span class="n">_get_web3_instance</span><span class="p">(</span><span class="n">l2_rpc_url</span><span class="p">,</span> <span class="s2">&quot;zkSync Era L2&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize state tracking</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;eralend_positions&quot;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Get tokens to track from config</span>
        <span class="n">tokens_to_track</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;random_activity&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;initial_state_fetch&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens_to_track_balance&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ETH&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="c1"># Fetch L2 balances</span>
        <span class="k">for</span> <span class="n">token_symbol</span> <span class="ow">in</span> <span class="n">tokens_to_track</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token_symbol</span> <span class="o">==</span> <span class="s2">&quot;ETH&quot;</span><span class="p">:</span>
                    <span class="c1"># Get native ETH balance</span>
                    <span class="n">balance_wei</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_balance</span><span class="p">(</span><span class="n">user_address</span><span class="p">)</span>
                    <span class="n">balance_ether</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">balance_wei</span><span class="p">))</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">18</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Get ERC20 token balance</span>
                    <span class="n">token_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_symbol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">token_config</span><span class="p">:</span>
                        <span class="n">token_address</span> <span class="o">=</span> <span class="n">token_config</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
                        <span class="n">decimals</span> <span class="o">=</span> <span class="n">token_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>

                        <span class="n">erc20_abi</span> <span class="o">=</span> <span class="n">_get_erc20_abi</span><span class="p">()</span>
                        <span class="n">token_contract</span> <span class="o">=</span> <span class="n">w3_l2</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span>
                            <span class="n">address</span><span class="o">=</span><span class="n">token_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">erc20_abi</span>
                        <span class="p">)</span>
                        <span class="n">balance_wei</span> <span class="o">=</span> <span class="n">token_contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">balanceOf</span><span class="p">(</span>
                            <span class="n">user_address</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
                        <span class="n">balance_ether</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">balance_wei</span><span class="p">))</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span>
                            <span class="mi">10</span><span class="o">**</span><span class="n">decimals</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">balance_ether</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">][</span><span class="n">token_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">balance_ether</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 </span><span class="si">{</span><span class="n">token_symbol</span><span class="si">}</span><span class="s2"> balance: </span><span class="si">{</span><span class="n">balance_ether</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch </span><span class="si">{</span><span class="n">token_symbol</span><span class="si">}</span><span class="s2"> balance: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">][</span><span class="n">token_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize lending positions (simplified for now)</span>
        <span class="k">for</span> <span class="n">token_symbol</span> <span class="ow">in</span> <span class="n">tokens_to_track</span><span class="p">:</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;eralend_positions&quot;</span><span class="p">][</span><span class="n">token_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;supplied&quot;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span>
                <span class="s2">&quot;borrowed&quot;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span>
                <span class="s2">&quot;is_collateral&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching initial on-chain state: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_action_sequence</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">num_total_actions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the sequence of random actions.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        config: Configuration dictionary</span>
<span class="sd">        state: Current on-chain state</span>
<span class="sd">        num_total_actions: Number of actions to perform</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (overall_success: bool, summary_message: str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;random_activity&quot;</span><span class="p">]</span>
    <span class="n">successful_actions_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">executed_actions_log</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stop_on_failure</span> <span class="o">=</span> <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stop_on_first_failure&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">action_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_total_actions</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing action </span><span class="si">{</span><span class="n">action_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">num_total_actions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Select and execute action</span>
        <span class="n">action_result</span> <span class="o">=</span> <span class="n">_select_and_execute_action</span><span class="p">(</span>
            <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">state</span>
        <span class="p">)</span>

        <span class="n">executed_actions_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">action_result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
            <span class="n">successful_actions_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Update state based on successful action</span>
            <span class="n">_update_internal_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action_result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action failed: </span><span class="si">{</span><span class="n">action_result</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stop_on_failure</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Stopping sequence due to failure&quot;</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="c1"># Compile summary</span>
    <span class="n">summary_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">executed_actions_log</span><span class="p">):</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;SUCCESS&quot;</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;FAILED&quot;</span>
        <span class="n">summary_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;action_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">summary_message</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Executed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">executed_actions_log</span><span class="p">)</span><span class="si">}</span><span class="s2"> actions, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">successful_actions_count</span><span class="si">}</span><span class="s2"> successful. &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary_parts</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">overall_success</span> <span class="o">=</span> <span class="n">successful_actions_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">overall_success</span><span class="p">,</span> <span class="n">summary_message</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_select_and_execute_action</span><span class="p">(</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select and execute a single random action.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        config: Configuration dictionary</span>
<span class="sd">        state: Current on-chain state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing action result details</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;random_activity&quot;</span><span class="p">]</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_action_selection_retries&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">retry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Select action type</span>
            <span class="n">action_type</span> <span class="o">=</span> <span class="n">_select_action_type</span><span class="p">(</span><span class="n">random_config</span><span class="p">[</span><span class="s2">&quot;action_weights&quot;</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected action type: </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Generate parameters for the action</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">_generate_action_parameters</span><span class="p">(</span><span class="n">action_type</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to generate parameters for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">action_type</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Check feasibility</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_action_feasibility</span><span class="p">(</span><span class="n">action_type</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2"> not feasible, retrying&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Execute the action</span>
            <span class="k">return</span> <span class="n">_execute_single_action</span><span class="p">(</span>
                <span class="n">action_type</span><span class="p">,</span> <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">config</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Action selection/execution failed (retry </span><span class="si">%d</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">retry</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c1"># All retries failed</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;action_type&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to select feasible action after retries&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tx_hash&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_select_action_type</span><span class="p">(</span><span class="n">action_weights</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select action type based on weights.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_weights: Dictionary of action types to weights</span>

<span class="sd">    Returns:</span>
<span class="sd">        Selected action type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">action_weights</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">action_weights</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">actions</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_generate_action_parameters</span><span class="p">(</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate randomized parameters for the selected action.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_type: Type of action to generate parameters for</span>
<span class="sd">        config: Configuration dictionary</span>
<span class="sd">        state: Current on-chain state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of parameters or None if generation failed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">random_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;random_activity&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;bridge_eth&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_randomize_bridge_parameters</span><span class="p">(</span>
                <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bridge_eth&quot;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">state</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;swap_tokens&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_randomize_swap_parameters</span><span class="p">(</span>
                <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;swap_tokens&quot;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">state</span><span class="p">,</span> <span class="n">config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;lend_borrow&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_randomize_lend_borrow_parameters</span><span class="p">(</span>
                <span class="n">random_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lend_borrow&quot;</span><span class="p">,</span> <span class="p">{}),</span> <span class="n">state</span><span class="p">,</span> <span class="n">config</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown action type: </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating parameters for </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_randomize_bridge_parameters</span><span class="p">(</span>
    <span class="n">bridge_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate randomized parameters for bridge_eth action.&quot;&quot;&quot;</span>
    <span class="n">amount_range</span> <span class="o">=</span> <span class="n">bridge_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount_range_eth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
    <span class="n">amount_eth</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">amount_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amount_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">probability_to_l2</span> <span class="o">=</span> <span class="n">bridge_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;probability_to_l2&quot;</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
    <span class="n">to_l2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">probability_to_l2</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;amount_eth&quot;</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">amount_eth</span><span class="p">)),</span> <span class="s2">&quot;to_l2&quot;</span><span class="p">:</span> <span class="n">to_l2</span><span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_randomize_swap_parameters</span><span class="p">(</span>
    <span class="n">swap_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate randomized parameters for swap_tokens action.&quot;&quot;&quot;</span>
    <span class="n">token_pairs</span> <span class="o">=</span> <span class="n">swap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token_pairs&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token_pairs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Select random token pair</span>
    <span class="n">token_in_symbol</span><span class="p">,</span> <span class="n">token_out_symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">token_pairs</span><span class="p">)</span>

    <span class="c1"># Get token addresses</span>
    <span class="n">tokens_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">token_in_config</span> <span class="o">=</span> <span class="n">tokens_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_in_symbol</span><span class="p">)</span>
    <span class="n">token_out_config</span> <span class="o">=</span> <span class="n">tokens_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_out_symbol</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">token_in_config</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">token_out_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">token_in_address</span> <span class="o">=</span> <span class="n">token_in_config</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
    <span class="n">token_out_address</span> <span class="o">=</span> <span class="n">token_out_config</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate amount based on balance percentage</span>
    <span class="n">balance</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_in_symbol</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">balance</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">percentage_range</span> <span class="o">=</span> <span class="n">swap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount_in_percentage_range&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
    <span class="n">percentage</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">percentage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">percentage_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">amount_ether</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">balance</span><span class="p">))</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percentage</span><span class="p">))</span>

    <span class="c1"># Convert to wei</span>
    <span class="n">decimals</span> <span class="o">=</span> <span class="n">token_in_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">amount_in</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_ether</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">decimals</span><span class="p">))</span>

    <span class="c1"># Random slippage</span>
    <span class="n">slippage_range</span> <span class="o">=</span> <span class="n">swap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slippage_bps_range&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>
    <span class="n">slippage_bps</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">slippage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slippage_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;token_in_address&quot;</span><span class="p">:</span> <span class="n">token_in_address</span><span class="p">,</span>
        <span class="s2">&quot;token_out_address&quot;</span><span class="p">:</span> <span class="n">token_out_address</span><span class="p">,</span>
        <span class="s2">&quot;amount_in&quot;</span><span class="p">:</span> <span class="n">amount_in</span><span class="p">,</span>
        <span class="s2">&quot;dex_name&quot;</span><span class="p">:</span> <span class="s2">&quot;syncswap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;slippage_bps&quot;</span><span class="p">:</span> <span class="n">slippage_bps</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_randomize_lend_borrow_parameters</span><span class="p">(</span>
    <span class="n">lend_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate randomized parameters for lend_borrow action.&quot;&quot;&quot;</span>
    <span class="n">sub_action_weights</span> <span class="o">=</span> <span class="n">lend_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sub_action_weights&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sub_action_weights</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Select sub-action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">_select_action_type</span><span class="p">(</span><span class="n">sub_action_weights</span><span class="p">)</span>

    <span class="c1"># Select token</span>
    <span class="n">supported_tokens</span> <span class="o">=</span> <span class="n">lend_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;supported_tokens&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ETH&quot;</span><span class="p">])</span>
    <span class="n">token_symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">supported_tokens</span><span class="p">)</span>

    <span class="n">tokens_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">token_config</span> <span class="o">=</span> <span class="n">tokens_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token_config</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">token_address</span> <span class="o">=</span> <span class="n">token_config</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>

    <span class="c1"># Generate amount based on action type</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">collateral_status</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;supply&quot;</span><span class="p">:</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_symbol</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">percentage_range</span> <span class="o">=</span> <span class="n">lend_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;supply_amount_percentage_range&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">percentage</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">percentage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">percentage_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">amount_ether</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percentage</span><span class="p">))</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="n">token_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_ether</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">decimals</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">&quot;set_collateral&quot;</span><span class="p">:</span>
        <span class="n">enable_probability</span> <span class="o">=</span> <span class="n">lend_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;set_collateral_enable_probability&quot;</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
        <span class="n">collateral_status</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">enable_probability</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Not used for set_collateral</span>

    <span class="c1"># For other actions (withdraw, borrow, repay), we&#39;d need more complex logic</span>
    <span class="c1"># based on existing positions, but for now we&#39;ll use simplified amounts</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
        <span class="s2">&quot;token_address&quot;</span><span class="p">:</span> <span class="n">token_address</span><span class="p">,</span>
        <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
        <span class="s2">&quot;lending_protocol_name&quot;</span><span class="p">:</span> <span class="s2">&quot;eralend&quot;</span><span class="p">,</span>
        <span class="s2">&quot;collateral_status&quot;</span><span class="p">:</span> <span class="n">collateral_status</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_check_action_feasibility</span><span class="p">(</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the action with given parameters is feasible.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_type: Type of action</span>
<span class="sd">        params: Action parameters</span>
<span class="sd">        state: Current on-chain state</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if action is feasible, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;bridge_eth&quot;</span><span class="p">:</span>
            <span class="c1"># Check if we have enough ETH for the bridge amount</span>
            <span class="n">amount_eth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount_eth&quot;</span><span class="p">]</span>
            <span class="n">eth_balance</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ETH&quot;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;to_l2&quot;</span><span class="p">]:</span>
                <span class="c1"># L1-&gt;L2: would need L1 balance check (simplified)</span>
                <span class="k">return</span> <span class="n">amount_eth</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># L2-&gt;L1: check L2 balance</span>
                <span class="k">return</span> <span class="n">eth_balance</span> <span class="o">&gt;=</span> <span class="n">amount_eth</span>

        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;swap_tokens&quot;</span><span class="p">:</span>
            <span class="c1"># Check if we have enough input token</span>
            <span class="n">amount_in</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount_in&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">amount_in</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Additional checks could be added for liquidity, etc.</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;lend_borrow&quot;</span><span class="p">:</span>
            <span class="c1"># Basic feasibility check</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;supply&quot;</span><span class="p">,</span> <span class="s2">&quot;borrow&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking feasibility for </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_execute_single_action</span><span class="p">(</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">private_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a single action with the given parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_type: Type of action to execute</span>
<span class="sd">        user_address: User&#39;s Ethereum address</span>
<span class="sd">        private_key: Private key for signing transactions</span>
<span class="sd">        params: Action parameters</span>
<span class="sd">        config: Configuration dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing execution result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;bridge_eth&quot;</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">bridge_eth</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount_eth&quot;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;to_l2&quot;</span><span class="p">],</span> <span class="n">config</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;swap_tokens&quot;</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">swap_tokens</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span>
                <span class="n">private_key</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;token_in_address&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;token_out_address&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount_in&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;dex_name&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;slippage_bps&quot;</span><span class="p">],</span>
                <span class="n">config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;lend_borrow&quot;</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">lend_borrow</span><span class="p">(</span>
                <span class="n">user_address</span><span class="p">,</span>
                <span class="n">private_key</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;token_address&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">],</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;lending_protocol_name&quot;</span><span class="p">],</span>
                <span class="n">config</span><span class="p">,</span>
                <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;collateral_status&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;action_type&quot;</span><span class="p">:</span> <span class="n">action_type</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown action type: </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tx_hash&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
            <span class="s2">&quot;action_type&quot;</span><span class="p">:</span> <span class="n">action_type</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="n">result</span><span class="p">,</span>
            <span class="s2">&quot;tx_hash&quot;</span><span class="p">:</span> <span class="n">result</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;action_type&quot;</span><span class="p">:</span> <span class="n">action_type</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
            <span class="s2">&quot;tx_hash&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_update_internal_state</span><span class="p">(</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">action_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update internal state based on successful action execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Current state dictionary to update</span>
<span class="sd">        action_result: Result of the executed action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">action_type</span> <span class="o">=</span> <span class="n">action_result</span><span class="p">[</span><span class="s2">&quot;action_type&quot;</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">action_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;bridge_eth&quot;</span><span class="p">:</span>
            <span class="n">amount_eth</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;amount_eth&quot;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
            <span class="n">to_l2</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;to_l2&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">to_l2</span><span class="p">:</span>
                <span class="c1"># L1-&gt;L2: increase L2 ETH balance</span>
                <span class="n">current_balance</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ETH&quot;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">][</span><span class="s2">&quot;ETH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">+</span> <span class="n">amount_eth</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># L2-&gt;L1: decrease L2 ETH balance</span>
                <span class="n">current_balance</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ETH&quot;</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">))</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;l2_balances&quot;</span><span class="p">][</span><span class="s2">&quot;ETH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="n">current_balance</span> <span class="o">-</span> <span class="n">amount_eth</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;swap_tokens&quot;</span><span class="p">:</span>
            <span class="c1"># For swaps, we&#39;d need to update both token balances</span>
            <span class="c1"># This is simplified - in reality we&#39;d need the actual output</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;lend_borrow&quot;</span><span class="p">:</span>
            <span class="c1"># Update lending positions based on the action</span>
            <span class="c1"># This is simplified - in reality we&#39;d need more detailed tracking</span>
            <span class="k">pass</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated state after </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error updating state after </span><span class="si">{</span><span class="n">action_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Airdrops Automation Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>